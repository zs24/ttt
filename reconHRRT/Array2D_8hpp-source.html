<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: Array2D.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>Array2D.hpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef ARRAY2D_HPP</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define ARRAY2D_HPP</span>
00003 <span class="preprocessor"></span><span class="comment">//---------------------------------------------------------------------</span>
00004 <span class="comment">//Defination of 2d Array class using 2d pointer, or pointer to</span>
00005 <span class="comment">//pointer, **p</span>
00006 <span class="comment">//Array is colomn majored, i.e, using FORTRAN and IDL convention</span>
00007 <span class="comment">//--------------------------------------------------------------------</span>
00008 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span>Array2D  
00009 {
00010 <span class="keyword">public</span>:
00011   <span class="comment">//-------------------------------------------------------------------</span>
00012   <span class="comment">//public member variables</span>
00013   <span class="comment">//-------------------------------------------------------------------</span>
00014   <span class="keywordtype">int</span> dim1, dim2; <span class="comment">//dimesions</span>
00015   <span class="keywordtype">float</span> loc1, loc2; <span class="comment">//offset of first index</span>
00016   <span class="keywordtype">float</span> step1, step2; <span class="comment">//sampling interval</span>
00017   string step_units1, step_units2; <span class="comment">//units of step</span>
00018   string units1, units2; <span class="comment">//units of the values</span>
00019         
00020   <span class="comment">//-------------------------------------------------------------</span>
00021   <span class="comment">// constructors</span>
00022   <span class="comment">//-------------------------------------------------------------</span>
00023   Array2D() { x=NULL; y=NULL;} <span class="comment">//default constructor</span>
00024   Array2D(<span class="keywordtype">int</span> N1,<span class="keywordtype">int</span> N2)   <span class="comment">//constructor with specified dimensions</span>
00025   {
00026     x=NULL; y=NULL; isnew =1;
00027     init(N1, N2);
00028   }
00029   Array2D(Array2D &amp; obj) {isnew = 1; copy(obj);} <span class="comment">//copy constructor</span>
00030   Array2D(T **pin,<span class="keywordtype">int</span> N1,<span class="keywordtype">int</span> N2)  <span class="comment">//constructor from 2d array</span>
00031   {
00032     dim1=N1; dim2=N2;
00033     isnew = 0;
00034     y =  pin;
00035     x = pin[0];
00036   }
00037  
00038   <span class="comment">//---------------------------------------------------------------</span>
00039   <span class="comment">// destructor</span>
00040   <span class="comment">//---------------------------------------------------------------</span>
00041   ~Array2D() 
00042   {
00043     <span class="keywordflow">if</span>(isnew &amp;&amp; x &amp;&amp; y) 
00044       {
00045         <span class="keyword">delete</span>[] x; <span class="keyword">delete</span> [] y;
00046       }
00047   }
00048 
00049   <span class="comment">//-----------------------------------------------------------------</span>
00050   <span class="comment">// operator overloading</span>
00051   <span class="comment">//----------------------------------------------------------------</span>
00052   Array2D&lt;T&gt; &amp; operator=(Array2D&lt;T&gt; &amp; obj)
00053   {
00054     <span class="keywordflow">if</span>(y==obj.y) <span class="keywordflow">return</span>(*this);
00055     <span class="keywordflow">if</span> (isnew)
00056       {
00057         <span class="keywordflow">if</span>(y) <span class="keyword">delete</span>[] y;
00058         <span class="keywordflow">if</span>(x) <span class="keyword">delete</span>[] x;
00059       }
00060     copy(obj);
00061     <span class="keywordflow">return</span>(*this);
00062   }
00063 
00064   Array2D&lt;T&gt; &amp; operator += (Array2D&lt;T&gt; &amp; obj)
00065   {
00066     <span class="keywordflow">if</span>(obj.dim1 != dim1 || obj.dim2 !=dim2){
00067       cout&lt;&lt;<span class="stringliteral">"Dimesion error when perform =+ of array2D"</span>&lt;&lt;endl;
00068       exit(-1);
00069     }
00070     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i1=0; i1&lt;dim1; i1++)
00071       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i2=0; i2&lt;dim2; i2++)
00072         y[i2][i1] += obj.y[i2][i1];
00073     <span class="keywordflow">return</span>(*this);
00074   }
00075 
00076   Array2D&lt;T&gt; &amp; operator/=(T obj)
00077   {
00078     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i1=0; i1&lt;dim1; i1++)
00079       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i2=0; i2&lt;dim2; i2++)
00080         y[i2][i1] /= obj;
00081     <span class="keywordflow">return</span>(*this);
00082   }
00083 
00084   T*  operator*(T obj[])
00085   {
00086     <span class="comment">/*if(dim2 != sizeof(obj)){</span>
00087 <span class="comment">      cout&lt;&lt;"Error in mutipulation of the matrix and the vector: </span>
00088 <span class="comment">         dimesion not match"&lt;&lt;endl;</span>
00089 <span class="comment">      cout&lt;&lt;"Size of the matrix ("&lt;&lt;dim1&lt;&lt;","&lt;&lt;dim2&lt;&lt;")"&lt;&lt;endl;</span>
00090 <span class="comment">      cout&lt;&lt;"Size of vector "&lt;&lt;sizeof(obj)&lt;&lt;sizeof(T)&lt;&lt;endl;</span>
00091 <span class="comment">      }*/</span>
00092     T*  result = <span class="keyword">new</span> T [dim1];
00093     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i1=0; i1&lt;dim1; i1++){
00094       result[i1]=0;
00095       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i2=0; i2&lt;dim2; i2++)
00096         result[i1] +=y[i2][i1]*obj[i2];
00097     }
00098     <span class="keywordflow">return</span> result;
00099   }
00100 
00101 
00102   T&amp; operator()(<span class="keywordtype">int</span> i1,<span class="keywordtype">int</span> i2) <span class="comment">//Accessor, access array(index1, index2)</span>
00103   {
00104                 
00105     <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2)
00106       {
00107         cout &lt;&lt; <span class="stringliteral">"Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">") &gt; ("</span>&lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00108         <span class="keywordflow">return</span>(**y);
00109       }
00110                 
00111     <span class="keywordflow">return</span>( y[i2][i1] );
00112   }
00113   <span class="keywordtype">void</span> operator=(<span class="keyword">const</span> T &amp; value)
00114   {
00115     <span class="keywordflow">if</span>(!x &amp;&amp; !y )
00116       {
00117         cout&lt;&lt;<span class="stringliteral">"Error in Array2D : Array not initialized... "</span>&lt;&lt;endl;
00118         exit(-1);
00119       }
00120     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;dim1*dim2; i++)
00121       x[i] = value;
00122   }
00123         
00124   <span class="comment">//return y^2</span>
00125   Array2D&lt;T&gt; operator^(<span class="keywordtype">int</span> p)
00126   {
00127     Array2D&lt;T&gt; power(dim1,dim2);
00128     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i1=0; i1&lt;dim1; i1++)
00129       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i2=0; i2&lt;dim2; i2++)
00130         power(i1, i2) = pow(y[i2][i1],p);
00131     <span class="keywordflow">return</span> power;
00132   }
00133         
00134   <span class="comment">//tranpose</span>
00135   Array2D&lt;T&gt; transpose()
00136   {
00137     Array2D&lt;T&gt; Trans(dim2, dim1);
00138     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i1=0; i1&lt;dim1; i1++)
00139       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i2=0; i2&lt;dim2; i2++)
00140         Trans(i2,i1) = y[i2][i1];
00141     <span class="keywordflow">return</span> Trans;
00142   }
00143         
00144   Array2D&lt;T&gt; operator+(<span class="keyword">const</span> Array2D &amp; array)
00145   {
00146     Array2D Add(dim1, dim2);
00147     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i1=0; i1&lt;dim1; i1++)
00148       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i2=0; i2&lt;dim2; i2++)
00149         Add(dim1, dim2) = y[dim2][dim1]+array(dim1,dim2);
00150     <span class="keywordflow">return</span> Add;
00151   }
00152         
00153   Array2D&lt;T&gt; Sqrt()
00154   {
00155     Array2D&lt;T&gt; array(dim1, dim2);
00156     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i1=0; i1&lt;dim1; i1++)
00157       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i2=0; i2&lt;dim2; i2++)
00158         array(dim1,dim2) = sqrt(y[dim2][dim1]);
00159     <span class="keywordflow">return</span> array;
00160   }
00161   <span class="comment">//------------------------------------------------------------</span>
00162   <span class="comment">//init function</span>
00163   <span class="comment">//-------------------------------------------------------     </span>
00164   <span class="keywordtype">void</span> init(<span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> N2)
00165   {
00166     dim1 = N1; dim2 = N2;
00167     <span class="comment">//if(isnew &amp;&amp; y) delete []y;</span>
00168     <span class="comment">//if(isnew &amp;&amp; x) delete []x;</span>
00169     isnew = 1;
00170     x = <span class="keyword">new</span> T[dim1*dim2];
00171     y = <span class="keyword">new</span> T* [dim2];
00172     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n = 0 ; n&lt; dim2; n++)
00173       y[n] = &amp;x[dim1*n];
00174     (*this) = 0;
00175   }
00176 
00177   <span class="keywordtype">void</span> reinit(<span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> N2)
00178   {
00179     assert(N1&gt;=dim1);
00180     assert(N2&gt;=dim2);
00181     T * xold;
00182     T* xnew;
00183     T ** yold;
00184     T ** ynew;
00185     xold=x;
00186     yold=y;
00187     xnew = <span class="keyword">new</span> T[N1*N2];
00188     ynew = <span class="keyword">new</span> T* [N2];
00189     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n = 0 ; n&lt; N2; n++)
00190       ynew[n] = &amp;xnew[N1*n];
00191     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n1=0;n1&lt;dim1;n1++)
00192       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n2=0;n2&lt;dim2;n2++)
00193         ynew[n2][n1]=yold[n2][n1];
00194     y = ynew;
00195     x = xnew;
00196     dim1=N1;
00197     dim2 = N2;
00198     <span class="keyword">delete</span>[] xold;
00199     <span class="keyword">delete</span>[] yold;
00200   }
00201 
00202   <span class="comment">//------------------------------------------------------------------</span>
00203   <span class="comment">//public utility functions</span>
00204   <span class="comment">//------------------------------------------------------------------</span>
00205   <span class="comment">//return pointer to specified index</span>
00206   T * ptr (<span class="keywordtype">int</span> i1, <span class="keywordtype">int</span> i2)
00207   { 
00208     <span class="keywordflow">return</span> (&amp;x[i1 + i2*dim1]);
00209   }
00210         
00211   <span class="comment">//Return a block of the Array starting at specified index</span>
00212   <span class="comment">//this allocates new memory</span>
00213   T * getBlock(<span class="keywordtype">int</span> i1, <span class="keywordtype">int</span> i2, <span class="keywordtype">int</span> size)
00214   {
00215                 
00216     <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2)
00217       {
00218         cout &lt;&lt; <span class="stringliteral">"Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">") &gt; ("</span>
00219              &lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00220         <span class="keywordflow">return</span>(x);
00221       }
00222     <span class="keywordflow">if</span>((i1+i2*dim1+size)&gt;dim1*dim2)
00223       {
00224         cout&lt;&lt;<span class="stringliteral">"Size too large: "</span>&lt;&lt;size&lt;&lt;endl;
00225         <span class="keywordflow">return</span>(x);
00226       }
00227                 
00228     T * block = <span class="keyword">new</span> T [size];
00229     memcpy(block, &amp;x[i1+i2*dim1], <span class="keyword">sizeof</span>(T)*size);
00230     <span class="keywordflow">return</span> (block);
00231   }
00232         
00233         
00234   <span class="comment">//Ressign a block of the array according to the passed </span>
00235   <span class="comment">// in pointer the another array</span>
00236   <span class="keywordtype">void</span> putBlock( <span class="keywordtype">int</span> i1, <span class="keywordtype">int</span> i2, <span class="keywordtype">int</span> size, T * array)
00237   {
00238                 
00239     <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2)
00240       {
00241         cout &lt;&lt; <span class="stringliteral">"Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">") &gt; ("</span>
00242              &lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00243         <span class="keywordflow">return</span>;
00244       }
00245     <span class="keywordflow">if</span>((i1+i2*dim1+size)&gt;dim1*dim2)
00246       {
00247         cout&lt;&lt;<span class="stringliteral">"Size too large: "</span>&lt;&lt;size&lt;&lt;endl;
00248         <span class="keywordflow">return</span>;
00249       }
00250                 
00251     memcpy(&amp;x[i1+i2*dim1], array, <span class="keyword">sizeof</span>(T)*size);
00252   }
00253         
00254   <span class="comment">//Get maximum value of the array</span>
00255   T max()
00256   {
00257     T maxVal = x[0]; 
00258     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;dim1*dim2; i++)
00259       {
00260         <span class="keywordflow">if</span> (x[i] &gt; maxVal) 
00261           maxVal = x[i];
00262       }
00263     <span class="keywordflow">return</span> maxVal;
00264   }
00265    
00266   <span class="comment">//Get minimum value of the array</span>
00267   T min()
00268   {
00269     T minVal = x[0];
00270     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;dim1*dim2; i++)
00271       {
00272         <span class="keywordflow">if</span> (x[i] &lt; minVal)
00273           minVal = x[i];
00274       }
00275     <span class="keywordflow">return</span> minVal;
00276   }
00277 
00282   <span class="keywordtype">int</span> getSize()
00283   {
00284     <span class="keywordflow">return</span> dim1*dim2;
00285   }
00286 <span class="keyword">private</span>:
00287   <span class="comment">//-------------------------------------------------------------------</span>
00288   <span class="comment">//private member variables</span>
00289   <span class="comment">//-------------------------------------------------------------------</span>
00290   T * x;
00291   T **y;
00292   <span class="keywordtype">int</span> isnew;
00293 
00294   <span class="comment">//-----------------------------------------------------------------</span>
00295   <span class="comment">// utility function</span>
00296   <span class="comment">//-------------------------------------------------------------------</span>
00297   <span class="keywordtype">void</span> copy(Array2D&amp; obj)
00298   {
00299     dim1=obj.dim1; dim2=obj.dim2;
00300     x = <span class="keyword">new</span> T[dim1*dim2];
00301     memcpy(x,obj.x,<span class="keyword">sizeof</span>(T)*dim1*dim2);
00302     y = <span class="keyword">new</span> T* [dim2];
00303     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n = 0 ; n&lt; dim2; n++)
00304       y[n] = &amp;x[dim1*n];
00305   }
00306 
00307 };
00308 
00309 <span class="keywordtype">void</span> Array2D&lt;EventPacket&gt;::init(<span class="keywordtype">int</span> N1, <span class="keywordtype">int</span> N2)
00310 {
00311   dim1 = N1; dim2 = N2;
00312   isnew = 1;
00313   x = <span class="keyword">new</span> <a class="code" href="classEventPacket.html">EventPacket</a>[dim1*dim2];
00314   y = <span class="keyword">new</span> EventPacket* [dim2];
00315   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> n = 0 ; n&lt; dim2; n++)
00316     y[n] = &amp;x[dim1*n];
00317 };
00318 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:46 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
