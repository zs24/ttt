<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: House.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>House.hpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef HOUSEHANDLER_HPP</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define HOUSEHANDLER_HPP</span>
00003 <span class="preprocessor"></span><span class="preprocessor">#include "IOConfig.hpp"</span>
00004 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00005 <span class="preprocessor">#include &lt;string.h&gt;</span>
00006 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00007 <span class="preprocessor">#include &lt;time.h&gt;</span>
00008 <span class="preprocessor">#include &lt;iostream&gt;</span>
00009 <span class="preprocessor">#include &lt;fstream&gt;</span>
00010 <span class="preprocessor">#include &lt;math.h&gt;</span>
00011 <span class="preprocessor">#include &lt;string&gt;</span>
00012 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00013 <span class="preprocessor">#include "array.hpp"</span>
00014 <span class="preprocessor">#include "EventPacket.hpp"</span>
00015 <span class="preprocessor">#include "XMLTree.hpp"</span>
00016 <span class="preprocessor">#include "Params.hpp"</span>
00017 <span class="preprocessor">#include "EventList.hpp"</span>
00018 <span class="preprocessor">#include "Log.hpp"</span>
00019 <span class="preprocessor">#include "Constant.hpp"</span>
00020 <span class="preprocessor">#include "ResolutionTable.hpp"</span>
00021 <span class="preprocessor">#include "TOC.hpp"</span>
00022 <span class="preprocessor">#include "MotionCorrection.hpp"</span>
00023 <span class="preprocessor">#include "PolarisMotionCorrection.hpp"</span>
00024 <span class="preprocessor">#include "HRRTScannerParams.hpp"</span>
00025 <span class="preprocessor">#include "CrystalID.hpp"</span>
00026 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00027 
00028 <span class="comment">//pre declare of the FrameInfo class</span>
00029 <span class="keyword">class </span><a class="code" href="classFrameInfo.html">FrameInfo</a>;
00030 
00031 <span class="keyword">class </span>House{
00032 
00045   <span class="keyword">struct </span>StatusStruct {
00046     <span class="keywordtype">int</span> stat_key;
00047     <span class="keywordtype">long</span> nRead; <span class="comment">//number of packets read</span>
00048     <span class="keywordtype">long</span> nEvent; <span class="comment">//number of events read</span>
00049     <span class="keywordtype">long</span> nPrompt;<span class="comment">//number of prompts read</span>
00050     <span class="keywordtype">long</span> nRandom;<span class="comment">//number of randoms read</span>
00051     <span class="keywordtype">long</span> nNonEvent;<span class="comment">//number of nonevent read</span>
00052     <span class="keywordtype">long</span> nAccept; <span class="comment">//number of accepted events</span>
00053     <span class="keywordtype">long</span> nReject; <span class="comment">//number of rejected events</span>
00054     <span class="keywordtype">long</span> nSkip;<span class="comment">// number of skip</span>
00055     <span class="keywordtype">long</span> nT; <span class="comment">//number of time tags</span>
00056     <span class="keywordtype">long</span> nS;
00057     <span class="keywordtype">long</span> nFf;
00058     <span class="keywordtype">long</span> nFb;
00059     <span class="keywordtype">long</span> nBb;
00060     <span class="keywordtype">long</span> nAdjh;
00061     <span class="keywordtype">long</span> nMisc1;
00062     <span class="keywordtype">long</span> nMiscs;
00063   };
00064 
00065 
00066   <span class="comment">//Note that essentially all functions in House.hpp are public and virtual </span>
00067 <span class="keyword">public</span>:
00068   
00071   <span class="keyword">virtual</span> <span class="keywordtype">void</span> init()=0;
00081   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> prepareListData()=0;
00082 
00092   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> prepareRandomizedListData()=0;
00093 
00094 
00115   <span class="keyword">virtual</span> <a class="code" href="classEventPacket.html">EventPacket</a> getNextEvent()=0;
00116 
00117 
00118 <span class="comment">/******************************************************</span>
00119 <span class="comment"> * putNextEvent() - Called from</span>
00120 <span class="comment"> * AlgorithmSimulation::collectDistribute()</span>
00121 <span class="comment"> * This function takes a fully-formed event packet, extracts the</span>
00122 <span class="comment"> * fundamental identifying variables, and decodes them into a</span>
00123 <span class="comment"> * raw-event (a 64-bit word) for output to a list-mode file</span>
00124 <span class="comment"> * representing a simulation  realization.  It keeps track of the</span>
00125 <span class="comment"> * current (or, actually "previous") time tag for a particular</span>
00126 <span class="comment"> * realization.  When the time tag changes, this function also writes</span>
00127 <span class="comment"> * out a time stamp event and a block singles event.</span>
00128 <span class="comment"> *@param event the event to be written</span>
00129 <span class="comment"> *@param realiz - The realization number which identifies the file to</span>
00130 <span class="comment"> *be written .  </span>
00131 <span class="comment"> *@return true if everything OK, false if errors in I/O or unProcessEvent</span>
00132 <span class="comment"> */</span>
00133   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> putNextEvent(<a class="code" href="classEventPacket.html">EventPacket</a> &amp; event, <span class="keywordtype">int</span> irealiz)=0;
00134 
00135   
00143   <span class="keyword">virtual</span> <a class="code" href="structResolutionTable.html">ResolutionTable</a> getResFunR(<span class="keyword">const</span> <span class="keywordtype">short</span> &amp; index)=0;
00144 
00145 
00153   <span class="keyword">virtual</span> <a class="code" href="structResolutionTable.html">ResolutionTable</a> getResFunZ(<span class="keyword">const</span> <span class="keywordtype">short</span> &amp; index)=0;
00154   <span class="comment">//return the resolution function in Z direction of the event, </span>
00155   <span class="comment">//according to the index</span>
00162 <span class="comment"></span>  <span class="keyword">virtual</span> <a class="code" href="classFrameInfo.html">FrameInfo</a> &amp; getFrameInfo()=0;
00163 
00168   <span class="keyword">virtual</span> <a class="code" href="classArray1D.html">Array1D&lt;int&gt;</a>&amp; getSingles()=0;
00169 
00179   <span class="keyword">virtual</span> <span class="keywordtype">int</span> getCrystalNumber(<span class="keywordtype">int</span> dtct, <span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> bank, <span class="keywordtype">int</span> ring)=0;
00180 
00186   <span class="keyword">virtual</span> <a class="code" href="classHRRTScannerParams.html">HRRTScannerParams</a> *getScannerParams()=0;
00187   
00188 
00196   <span class="keyword">virtual</span> <span class="keywordtype">float</span> getRandoms(<span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e1, <span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp;e2)=0;
00197  
00203   <span class="keyword">virtual</span> <a class="code" href="structCrystalID.html">CrystalID</a> getHrrtId(<span class="keywordtype">int</span> n)=0;
00204 
00210   <span class="keyword">virtual</span> <span class="keywordtype">float</span>  getTotalPossibleEvents()=0;
00211 
00212   <span class="keyword">virtual</span> <span class="keywordtype">long</span> getAcceptedEvents()=0;
00213   <span class="keyword">virtual</span> <span class="keywordtype">long</span> getRejectedEvents()=0;
00218    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> isTimeTag(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *b)=0;
00223   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> isSinglesTag(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *b)=0;
00228    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> isEvent(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *b)=0;
00235    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> processEvent(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *b, <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e1, 
00236                     <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e2)=0;
00243    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> calculateEventParams(<span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e1, 
00244                            <span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e2,
00245                            <a class="code" href="classEventPacket.html">EventPacket</a> &amp;event, <span class="keywordtype">int</span> t)=0;
00248   <span class="keyword">virtual</span> <span class="keywordtype">float</span> getSen(<span class="keywordtype">int</span> dtct, <span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> bank, <span class="keywordtype">int</span> ring, <span class="keywordtype">int</span> singles) =0;
00259   <span class="keyword">virtual</span> <span class="keywordtype">void</span> bcastSinglesPackets()=0;
00260 
00261 
00262 
00263 
00264 <span class="comment">/**************************************************</span>
00265 <span class="comment"> * prepareOutput</span>
00266 <span class="comment"> * This is a public function (to the parent) that needs to be called from</span>
00267 <span class="comment"> * AlgorithmSimulation::collectDistribute() prior to the actual</span>
00268 <span class="comment"> * redistribution of events.  It opens the output file corresponding</span>
00269 <span class="comment"> * to realization irealiz.  The filename is formed from the listmode</span>
00270 <span class="comment"> * filename in params.frame.listmodeFilename, with a substring</span>
00271 <span class="comment"> * inserted identifying the realization in front of the last "."</span>
00272 <span class="comment"> * In the event of an error condition, Utilities::cleanup() is called.</span>
00273 <span class="comment"> *@param irealiz - Identifies the realization number</span>
00274 <span class="comment"> ***************************/</span>
00275 
00276   <span class="keyword">virtual</span> <span class="keywordtype">void</span> prepareOutput(<span class="keywordtype">int</span> irealiz)=0;
00277 
00278 
00279 <span class="comment">/*************************************************************************</span>
00280 <span class="comment"> * finalizeOutput</span>
00281 <span class="comment"> * Called toward the end of AlgorithmSimulation::collectDistribute,</span>
00282 <span class="comment"> * this function closes the output list-mode realization files</span>
00283 <span class="comment"> * assigned to the processor.</span>
00284 <span class="comment"> * If the realization number is not assigned to the current processor,</span>
00285 <span class="comment"> * this function will generate an error condition and call </span>
00286 <span class="comment"> * Utilities::cleanup()</span>
00287 <span class="comment"> ********************************************/</span>
00288 
00289   <span class="keyword">virtual</span> <span class="keywordtype">void</span> finalizeOutput(<span class="keywordtype">int</span> irealiz)=0;
00290 
00291 <span class="comment">/*********************************************************</span>
00292 <span class="comment"> * maskOut</span>
00293 <span class="comment"> * making the maskOut method public to classes outside the House</span>
00294 <span class="comment"> ****************************************************************/</span>
00295 
00296  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> maskOut(<span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e1, <span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e2)=0; 
00297 
00298 
00299 <span class="keyword">public</span>:
00300   House(){};
00301 };
00302 
00303 <span class="preprocessor">#endif //HOUSEHANDLER_HPP</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:47 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
