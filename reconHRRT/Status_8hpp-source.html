<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: Status.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>Status.hpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef STATUS_HPP</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define STATUS_HPP</span>
00003 <span class="preprocessor"></span><span class="comment">/*Status class provides the values that are updated by the algorithm </span>
00004 <span class="comment"> *and written to the status file</span>
00005 <span class="comment"> *@param iter iteration number</span>
00006 <span class="comment"> *@param subset subset number</span>
00007 <span class="comment"> *@param numProcs number of processors</span>
00008 <span class="comment"> *@param proc processor number</span>
00009 <span class="comment"> *@param reconTime reconstruction time hh:mm:ss</span>
00010 <span class="comment"> *@param comment the comment to be conveyed to the user</span>
00011 <span class="comment">*/</span>
00012 <span class="preprocessor">#include&lt;iostream&gt;</span>
00013 <span class="preprocessor">#include&lt;fstream&gt;</span>
00014 <span class="preprocessor">#include&lt;mpi.h&gt;</span>
00015 <span class="preprocessor">#include&lt;time.h&gt;</span>
00016 <span class="preprocessor">#include&lt;sstream&gt;</span>
00017 <span class="preprocessor">#include&lt;sys/utsname.h&gt;</span>
00018 <span class="preprocessor">#include "Params.hpp"</span>
00019 <span class="preprocessor">#include "Log.hpp"</span>
00020 
00021 <span class="keyword">class </span>Status
00022 {
00023 <span class="keyword">public</span>:    
00024   <span class="comment">// We should probably have getters and setters for most of</span>
00025   <span class="comment">//thesevariables</span>
00029 <span class="comment"></span>  <span class="keyword">enum</span> StatusCode{SUBMITTED=100, RUNNING=101, EXECUTING=102, 
00030                   COMPLETED=103,ERROR=104, SWAPPING = 105} statusCode;
00031   
00032   Array2D&lt;int&gt;  barrierTimes; <span class="comment">//waiting time for each processor before global</span>
00033                         <span class="comment">//summing "nu" array, for each iteration</span>
00034 
00035 <span class="keyword">private</span>:
00036   string setReconTime();<span class="comment">//set current time as current clock time</span>
00037   string fileName;
00038 
00039   <span class="keywordtype">void</span> write();        <span class="comment">// writes the status file</span>
00040   <span class="keywordtype">void</span> setComment(string comm); <span class="comment">//set comment</span>
00041   <span class="keywordtype">void</span> setStatusCode(StatusCode code);<span class="comment">//set status code 100 to 104</span>
00042   <span class="keywordtype">float</span> * eventLoad;  <span class="comment">// stores the proportion of events, from 0 to 1,</span>
00043                      <span class="comment">// for each processor.  The size of the array is</span>
00044                      <span class="comment">// the instance variabke "numProcs".</span>
00045 
00046   <span class="comment">/**********************************************************************</span>
00047 <span class="comment">   * determineEventLoad</span>
00048 <span class="comment">   * This function puts together the private instance array eventLoad.</span>
00049 <span class="comment">   * The array is allocated with numProcs elements.  This function is</span>
00050 <span class="comment">   * called from init().  It uses an MPI global collect operation to put</span>
00051 <span class="comment">   * together the array. The array is then scaled according to its</span>
00052 <span class="comment">   * maximum so that valid values have a range from zero to one.  If</span>
00053 <span class="comment">   * there are any negative values in the array, then all elements in</span>
00054 <span class="comment">   * the array are set to 1.</span>
00055 <span class="comment">   *******************************************/</span>
00056   
00057   <span class="keywordtype">void</span> determineEventLoad();
00058   
00059 
00060 
00061   <span class="comment">/***************************************************************</span>
00062 <span class="comment">   * determineCPUspeed</span>
00063 <span class="comment">   * This is a private function , called from within determineEventLoad,</span>
00064 <span class="comment">   * that reads the /proc/cpuinfo file to determine the clock speed of</span>
00065 <span class="comment">   * the processor, in MHz.  NOTE that this is a Linux-only feature.</span>
00066 <span class="comment">   * Should the computer not have such a file as /proc/cpuinfo, the</span>
00067 <span class="comment">   * return value will be negative, which indicates that active load</span>
00068 <span class="comment">   * balancing should not be attempted.</span>
00069 <span class="comment">   *@return The clock speed in MHz.</span>
00070 <span class="comment">   ******************************/</span>
00071   
00072   <span class="keywordtype">float</span> determineCPUspeed();
00073   
00074 
00075 <span class="keyword">public</span>:         
00076         
00077   <span class="keywordtype">int</span> iter;   <span class="comment">// iteration number</span>
00078   <span class="keywordtype">int</span> subset; <span class="comment">// subset number</span>
00079   <span class="keywordtype">int</span> numProcs; <span class="comment">// number of processors</span>
00080   <span class="keywordtype">int</span> proc;    <span class="comment">// processor</span>
00081   string jobStartTime;          <span class="comment">//hh::mm::ss the time the job started</span>
00082   string currentTime;           <span class="comment">// hh:mm:ss the time the status file updated</span>
00083   string comment;        <span class="comment">// to be conveyed to the user, </span>
00084                          <span class="comment">//such as "running iteration ##, subset ##"</span>
00085   <span class="keywordtype">int</span> seed;
00086 
00087 
00088   Status();    <span class="comment">// constructor</span>
00089   ~Status();    <span class="comment">//destructor</span>
00096 <span class="comment"></span>  <span class="keywordtype">void</span> init(Params &amp;params, <span class="keywordtype">int</span> &amp;argc, <span class="keywordtype">char</span>**&amp; argv); <span class="comment">//initialization</span>
00102 <span class="comment"></span>  <span class="keywordtype">void</span> update(string comm, StatusCode code); <span class="comment">//update status file</span>
00106 <span class="comment"></span>  <span class="keywordtype">void</span> read();
00111   <span class="keyword">static</span> Status * getStatus()
00112   {
00113     <span class="keyword">static</span> Status status;
00114     <span class="keywordflow">return</span> &amp;status;
00115   };
00116 
00117   <span class="comment">/*********************************************************************</span>
00118 <span class="comment">   * getEventLoad</span>
00119 <span class="comment">   * This function returns the rescaled proportional event load for the</span>
00120 <span class="comment">   * specified processor.  This number should be based on the clock</span>
00121 <span class="comment">   * speed of the processor as specified in the /proc/cpuinfo file.  In</span>
00122 <span class="comment">   * the event that not all processors were able to read in their clock</span>
00123 <span class="comment">   * speeds, then the value returned bere will always be 1*rescale.</span>
00124 <span class="comment">   * @param procnum - The processor rank in question, for which the</span>
00125 <span class="comment">   * proportional load is being queried.</span>
00126 <span class="comment">   * @rescale - A floating point value that should represent the maximum</span>
00127 <span class="comment">   * proportion.</span>
00128 <span class="comment">   * @return - The rescaled proportional event load of the specified</span>
00129 <span class="comment">   * processor.</span>
00130 <span class="comment">   **********/</span>
00131   
00132   <span class="keywordtype">float</span> getEventLoad(<span class="keywordtype">int</span> procnum, <span class="keywordtype">float</span> rescale);
00133 
00134   <span class="keywordtype">void</span> printMemInfo();    
00135 };
00136 <span class="preprocessor">#endif //STATUS_HPP</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:48 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
