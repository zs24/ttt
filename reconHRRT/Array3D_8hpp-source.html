<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: Array3D.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>Array3D.hpp</h1><div class="fragment"><pre>00001 
<a name="l00006"></a><a class="code" href="classArray3D.html">00006</a> <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class </span><a class="code" href="classArray3D.html">Array3D</a>
00007 {
00008   
00009 <span class="keyword">public</span>:
00010   <span class="comment">//----------------------------------</span>
00011   <span class="comment">//public member variables</span>
00012   <span class="comment">//----------------------------------</span>
00013   <span class="keywordtype">int</span> dim1, dim2, dim3; <span class="comment">//dimensions on 3 direction</span>
00014   <span class="keywordtype">float</span> loc1, loc2, loc3; <span class="comment">//offsets of first index</span>
00015   <span class="keywordtype">float</span> step1, step2, step3; <span class="comment">//sampling interval</span>
00016   string step_units1,step_units2,step_units3; <span class="comment">//units of step;</span>
00017   string unit; <span class="comment">//units of the values </span>
00018   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classMOLAR.html">MOLAR</a>;
00019   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classAlgorithm.html">Algorithm</a>;
00020   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classAlgorithmOSEM.html">AlgorithmOSEM</a>;
00021 
<a name="l00025"></a><a class="code" href="classArray3D.html#a0">00025</a>   <a class="code" href="classArray3D.html#a0">Array3D</a>() {x=NULL;y=NULL;z=NULL;isnew =1;} <span class="comment">//default constructor</span>
<a name="l00032"></a><a class="code" href="classArray3D.html#a1">00032</a> <span class="comment"></span>  <a class="code" href="classArray3D.html#a0">Array3D</a>(<span class="keywordtype">int</span> Nx,<span class="keywordtype">int</span> Ny,<span class="keywordtype">int</span> Nz) <span class="comment">//constructor with specified dimesions</span>
00033   {
00034     x=NULL;y=NULL;z=NULL;isnew =1;
00035     <a class="code" href="classArray3D.html#a8">init</a>(Nx,Ny,Nz);
00036   }
<a name="l00041"></a><a class="code" href="classArray3D.html#a2">00041</a>   <a class="code" href="classArray3D.html#a0">Array3D</a>(<a class="code" href="classArray3D.html">Array3D</a>&amp; obj) 
00042   {isnew =1; 
00043   copy(obj);
00044   } <span class="comment">//copy constructor</span>
<a name="l00052"></a><a class="code" href="classArray3D.html#a3">00052</a> <span class="comment"></span>  <a class="code" href="classArray3D.html#a0">Array3D</a>(T*** pin,<span class="keywordtype">int</span> Nx, <span class="keywordtype">int</span> Ny ,<span class="keywordtype">int</span> Nz) <span class="comment">//constructor from another 3D array</span>
00053   {
00054     <span class="keywordtype">int</span> N1 = Nx, N2= Nz, N3 = Ny;
00055     dim1=N1; dim2=N2; dim3=N3;
00056     isnew = 0;
00057     z = pin;
00058     y = pin[0];
00059     x = pin[0][0];
00060   }
00061         
00062 
<a name="l00066"></a><a class="code" href="classArray3D.html#a4">00066</a>   <a class="code" href="classArray3D.html#a4">~Array3D</a>() 
00067   {
00068     <span class="keywordflow">if</span>(isnew &amp;&amp; x &amp;&amp; y &amp;&amp; z) {
00069       <span class="keyword">delete</span>[] x; <span class="keyword">delete</span>[] y; <span class="keyword">delete</span> [] z;
00070     }
00071   }
00072 
<a name="l00078"></a><a class="code" href="classArray3D.html#a5">00078</a>    <a class="code" href="classArray3D.html">Array3D&lt;T&gt;</a> &amp; <a class="code" href="classArray3D.html#a5">operator=</a>(<a class="code" href="classArray3D.html">Array3D&lt;T&gt;</a> &amp; obj)
00079   {
00080     <span class="keywordflow">if</span>(z==obj.<a class="code" href="classArray3D.html#p2">z</a>) <span class="keywordflow">return</span>(*this);
00081     <span class="keywordflow">if</span> (isnew)
00082       {
00083         <span class="keywordflow">if</span>(z) <span class="keyword">delete</span>[] z;
00084         <span class="keywordflow">if</span>(y) <span class="keyword">delete</span>[] y;
00085         <span class="keywordflow">if</span>(x) <span class="keyword">delete</span>[] x;
00086       }
00087     copy(obj);
00088     <span class="keywordflow">return</span>(*this);
00089   }
<a name="l00094"></a><a class="code" href="classArray3D.html#a6">00094</a>   <span class="keywordtype">void</span> <a class="code" href="classArray3D.html#a5">operator=</a>(<span class="keyword">const</span> T &amp; value)
00095   {
00096     <span class="keywordflow">if</span>(!x &amp;&amp; !y &amp;&amp; !z)
00097       {
00098         cout&lt;&lt;<span class="stringliteral">"Error in Array3D : Array not initialized... "</span>&lt;&lt;endl;
00099         exit(-1);
00100       }
00101     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i&lt;dim1*dim2*dim3; i++)
00102       x[i] = value;
00103   }
00104         
<a name="l00111"></a><a class="code" href="classArray3D.html#a7">00111</a>   T&amp; <a class="code" href="classArray3D.html#a7">operator()</a>(<span class="keywordtype">int</span> ix,<span class="keywordtype">int</span> iy,<span class="keywordtype">int</span> iz) <span class="comment">//Accesor, access arrary(, ,) </span>
00112   {
00113      <span class="keywordtype">int</span> i1 = ix, i2 = iz, i3 =iy;
00114 
00115      <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2||i3&lt;0||dim3&lt;=i3) {
00116        cout &lt;&lt; <span class="stringliteral">"A. Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i3&lt;&lt;<span class="stringliteral">") &gt; ("</span>;
00117        cout &lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim3&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00118        <span class="keywordflow">return</span>(***z);
00119      }
00120                 
00121     <span class="keywordflow">return</span>( z[i3][i2][i1] );
00122   }
00123         
00124         
00125         
<a name="l00132"></a><a class="code" href="classArray3D.html#a8">00132</a>   <span class="keywordtype">void</span> <a class="code" href="classArray3D.html#a8">init</a>(<span class="keywordtype">int</span> Nx, <span class="keywordtype">int</span> Ny, <span class="keywordtype">int</span> Nz)
00133   {
00134     dim1 =Nx; dim2 = Nz; dim3 = Ny;
00135     <span class="keywordflow">if</span> (isnew)
00136       {
00137         <span class="keywordflow">if</span>(z) <span class="keyword">delete</span>[] z;
00138         <span class="keywordflow">if</span>(y) <span class="keyword">delete</span>[] y;
00139         <span class="keywordflow">if</span>(x) <span class="keyword">delete</span>[] x;
00140       }
00141     isnew = 1;
00142     x = <span class="keyword">new</span> T[dim1*dim2*dim3];
00143     y = <span class="keyword">new</span> T*[dim2*dim3];
00144     z = <span class="keyword">new</span> T**[dim3];
00145     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n&lt; dim2*dim3; n++)
00146       y[n] = &amp;x[dim1*n];
00147     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;dim3;n++)
00148       z[n] = &amp;y[dim2*n];
00149     (*this) = 0;
00150   }
00151         
00152   <span class="comment">//--------------------------------------------------------------------------</span>
00153   <span class="comment">//public utility functions</span>
00154   <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00161"></a><a class="code" href="classArray3D.html#a9">00161</a> <span class="comment"></span>  T * <a class="code" href="classArray3D.html#a9">ptr</a>(<span class="keywordtype">int</span> ix, <span class="keywordtype">int</span> iy, <span class="keywordtype">int</span> iz)
00162   {
00163     <span class="keywordtype">int</span> i1=ix, i2=iz, i3 = iy;
00164                 
00165     <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2||i3&lt;0||dim3&lt;=i3) 
00166       {
00167         cout &lt;&lt; <span class="stringliteral">"B. Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i3&lt;&lt;<span class="stringliteral">") &gt; ("</span>;
00168         cout &lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim3&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00169         <span class="keywordflow">return</span>(**z);
00170       }
00171                 
00172     <span class="keywordflow">return</span> (&amp; z[i3][i2][i1]);
00173   }
00174         
<a name="l00184"></a><a class="code" href="classArray3D.html#a10">00184</a>   T* <a class="code" href="classArray3D.html#a10">getBlock</a>( <span class="keywordtype">int</span> ix, <span class="keywordtype">int</span> iy, <span class="keywordtype">int</span> iz, <span class="keywordtype">int</span> size)
00185   {
00186                 
00187     <span class="keywordtype">int</span> i1 = ix, i2 = iz, i3 =iy;
00188     <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2||i3&lt;0||dim3&lt;=i3) {
00189       cout &lt;&lt; <span class="stringliteral">"C. Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i3&lt;&lt;<span class="stringliteral">") &gt; ("</span>;
00190       cout &lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim3&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00191       <span class="keywordflow">return</span>(**z);
00192     }
00193     <span class="keywordflow">if</span>((i1*dim2*dim3+i2*dim3+i3+size)&gt;(dim1*dim2*dim3)) {
00194       cout &lt;&lt; <span class="stringliteral">"Size too large : "</span>&lt;&lt;size&lt;&lt;endl;
00195       <span class="keywordflow">return</span>(**z);
00196     }
00197                 
00198     T * block = <span class="keyword">new</span> T [size];
00199     memcpy(block, &amp;x[i1+i2*dim1+i3*dim1*dim2], <span class="keyword">sizeof</span>(T)*size);
00200     <span class="keywordflow">return</span> (block);
00201   }
<a name="l00206"></a><a class="code" href="classArray3D.html#a11">00206</a>   T* <a class="code" href="classArray3D.html#a11">getOrderBlock</a>( <span class="keywordtype">int</span> ix, <span class="keywordtype">int</span> iy, <span class="keywordtype">int</span> iz)
00207   {
00208                 
00209     <span class="keywordtype">int</span> i1 = ix, i2 = iz, i3 =iy;
00210     <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2||i3&lt;0||dim3&lt;=i3) {
00211       cout &lt;&lt; <span class="stringliteral">"D. Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i3&lt;&lt;<span class="stringliteral">") &gt; ("</span>;
00212       cout &lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim3&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00213       <span class="keywordflow">return</span>(**z);
00214     }
00215                 
00216     T * block = <span class="keyword">new</span> T [dim1*dim3];
00217     <span class="keywordtype">int</span> index = 0, jz= iz;
00218     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jx = ix; jx&lt;ix+dim1; jx++)
00219       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jy = iy; jy&lt;iy+dim3; jy++){
00220         block[index] = z[jy][jz][jx];
00221         index ++;
00222       }
00223     
00224     <span class="keywordflow">return</span> (block);
00225   }
00226 
<a name="l00232"></a><a class="code" href="classArray3D.html#a12">00232</a>   T <a class="code" href="classArray3D.html#a12">innerProduct</a>(<a class="code" href="classArray3D.html">Array3D&lt;T&gt;</a> &amp; second)
00233   {
00234     T innerProduction = 0;
00235     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0 ; i&lt;dim1*dim2*dim3; i++){
00236       innerProduction += this-&gt;x[i]*second.<a class="code" href="classArray3D.html#p0">x</a>[i];
00237     }
00238     <span class="keywordflow">return</span> innerProduction;
00239   }
00240       
<a name="l00250"></a><a class="code" href="classArray3D.html#a13">00250</a>   <span class="keywordtype">void</span> <a class="code" href="classArray3D.html#a13">putBlock</a>(<span class="keywordtype">int</span> ix, <span class="keywordtype">int</span> iy, <span class="keywordtype">int</span> iz, <span class="keywordtype">int</span> size, T* array)
00251   {
00252     
00253     <span class="keywordtype">int</span> i1 = ix, i2 = iz, i3 =iy;
00254                 
00255     <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2||i3&lt;0||dim3&lt;=i3) 
00256       {
00257         cout &lt;&lt; <span class="stringliteral">"E. Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i3&lt;&lt;<span class="stringliteral">") &gt; ("</span>;
00258         cout &lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim3&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00259         <span class="keywordflow">return</span>;
00260       }
00261     <span class="keywordflow">if</span>((i1+i2*dim1+i3*dim1*dim2+size)&gt;(dim1*dim2*dim3))
00262       {
00263         cout &lt;&lt; <span class="stringliteral">"Size too large : "</span>&lt;&lt;size&lt;&lt;endl;
00264         <span class="keywordflow">return</span>;
00265       }
00266     memcpy(&amp;x[i1+i2*dim1+i3*dim1*dim2], array, <span class="keyword">sizeof</span>(T)*size);
00267   }
00268  
<a name="l00273"></a><a class="code" href="classArray3D.html#a14">00273</a>   <span class="keywordtype">void</span> <a class="code" href="classArray3D.html#a14">putOrderBlock</a>(<span class="keywordtype">int</span> ix, <span class="keywordtype">int</span> iy, <span class="keywordtype">int</span> iz,  T* array)
00274   {
00275     
00276     <span class="keywordtype">int</span> i1 = ix, i2 = iz, i3 =iy;
00277                 
00278     <span class="keywordflow">if</span>(i1&lt;0||dim1&lt;=i1||i2&lt;0||dim2&lt;=i2||i3&lt;0||dim3&lt;=i3){
00279       cout &lt;&lt; <span class="stringliteral">"F. Bad index ("</span>&lt;&lt;i1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;i3&lt;&lt;<span class="stringliteral">") &gt; ("</span>;
00280       cout &lt;&lt;dim1&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim2&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dim3&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt; endl;
00281       <span class="keywordflow">return</span>;
00282     }
00283     <span class="keywordtype">int</span> index = 0, jz= iz;
00284     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jx = ix; jx&lt;ix+dim1; jx++)
00285       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jy = iy; jy&lt;iy+dim3; jy++){
00286         z[jy][jz][jx]= array[index];
00287         index ++;
00288       }
00289 
00290   }
00291                 
<a name="l00296"></a><a class="code" href="classArray3D.html#a15">00296</a>   T <a class="code" href="classArray3D.html#a15">max</a>()
00297   {
00298     T maxVal = x[0]; 
00299     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;dim1*dim2*dim3; i++)
00300       {
00301         <span class="keywordflow">if</span> (x[i] &gt; maxVal) 
00302           maxVal = x[i];
00303       }
00304     <span class="keywordflow">return</span> maxVal;
00305   }
00306    
<a name="l00311"></a><a class="code" href="classArray3D.html#a16">00311</a>   T <a class="code" href="classArray3D.html#a16">min</a>()
00312   {
00313     T minVal = x[0]; 
00314     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;dim1*dim2*dim3; i++)
00315       {
00316         <span class="keywordflow">if</span> (x[i] &lt; minVal) 
00317           minVal = x[i];
00318       }
00319     <span class="keywordflow">return</span> minVal;
00320   }
<a name="l00325"></a><a class="code" href="classArray3D.html#a17">00325</a>   T <a class="code" href="classArray3D.html#a17">average</a>()
00326   {
00327     T aveValue = 0;
00328     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;dim1*dim2*dim3; i++){ 
00329       aveValue += x[i];
00330     }
00331     aveValue /= dim1*dim2*dim3;
00332     <span class="keywordflow">return</span> aveValue
00333 ;
00334   }
00335 
00336 <span class="keyword">protected</span>:
00337   <span class="comment">//------------------------------------------</span>
00338   <span class="comment">//private member variables</span>
00339   <span class="comment">//-------------------------------------------</span>
00340   T* x; <span class="comment">//1d pointer where the data actually stored</span>
00341   T** y;<span class="comment">//2d pointer</span>
00342   T*** z;<span class="comment">//3d pointer</span>
00343   <span class="keywordtype">int</span> isnew;<span class="comment">//new or not</span>
00344 
00345   <span class="comment">//copy from another array obj</span>
00346   <span class="keywordtype">void</span> copy(<a class="code" href="classArray3D.html">Array3D</a>&amp; obj) 
00347   {
00348     dim1=obj.<a class="code" href="classArray3D.html#o0">dim1</a>; dim2=obj.<a class="code" href="classArray3D.html#o1">dim2</a>; dim3=obj.<a class="code" href="classArray3D.html#o2">dim3</a>;
00349     x = <span class="keyword">new</span> T[dim1*dim2*dim3];
00350     memcpy(x,obj.<a class="code" href="classArray3D.html#p0">x</a>,<span class="keyword">sizeof</span>(T)*dim1*dim2*dim3);
00351     y = <span class="keyword">new</span> T*[dim2*dim3];
00352     z = <span class="keyword">new</span> T**[dim3];
00353     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n&lt; dim2*dim3; n++)
00354       y[n] = &amp;x[dim1*n];
00355     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n&lt;dim3;n++)
00356       z[n] = &amp;y[dim2*n];
00357   }
00358 };
00359 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:46 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
