<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: IsoGaussian.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>IsoGaussian.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include "IsoGaussian.hpp"</span>
00002 
00003 <span class="comment">// calculation kernel on transaxial direction</span>
<a name="l00004"></a><a class="code" href="classIsoGaussian.html#b1">00004</a> <span class="keywordtype">void</span> <a class="code" href="classIsoGaussian.html#b1">IsoGaussian::calculateKernelR</a>(Params &amp; params)
00005 {
00006   <span class="keywordtype">float</span> hmax = 1; <span class="comment">//maxum value of kernel</span>
00007   <span class="keywordtype">float</span> hp1 = params.resolutionModel.percentCutoff*hmax; 
00008     <span class="comment">//value at percent cutoff</span>
00009   <span class="keywordtype">float</span> x[Constant::LENGTH_RESFUN]; 
00010     <span class="comment">//coordinate in resolution function space</span>
00011   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iKernel=0; iKernel&lt;   Constant::LENGTH_RESFUN; iKernel++)
00012     x[iKernel] = iKernel- Constant::LENGTH_RESFUN/2.0;
00013   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iResTableR = 0; iResTableR&lt; numResTableR; iResTableR ++){
00014     
00015     <span class="keywordtype">float</span> rp1 = sqrt(log(hp1)/(-2.772))*fwhmR(iResTableR);
00016                <span class="comment">//percent cutoff coordinates</span>
00017     resFunR[iResTableR].<a class="code" href="structResolutionTable.html#o2">upSpread</a> = resFunR[iResTableR].<a class="code" href="structResolutionTable.html#o1">downSpread</a> = rp1;
00018     resFunR[iResTableR].<a class="code" href="structResolutionTable.html#o3">magnification</a> = 
00019       Constant::RESFUNCUTOFF*Constant::LENGTH_RESFUN/(2*rp1);
00020               <span class="comment">//magnification</span>
00021     resFunR[iResTableR].<a class="code" href="structResolutionTable.html#o0">kCentralIndex</a> = Constant::LENGTH_RESFUN/2;
00022     <span class="keywordtype">float</span> dx = params.geometry.dX/resFunR[iResTableR].<a class="code" href="structResolutionTable.html#o3">magnification</a>;
00023          <span class="comment">//sampling distance</span>
00024     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iKernel=0; iKernel&lt; Constant::LENGTH_RESFUN; iKernel++){
00025       <span class="comment">//calculate kernel</span>
00026         
00027       resFunR[iResTableR].<a class="code" href="structResolutionTable.html#o4">kernel</a>[iKernel] = 
00028         exp(-2.772*POW2((x[iKernel]*dx/fwhmR(iResTableR))));
00029     }
00030   }
00031 }
00032         
00033 
00034 <span class="comment">// calculation kernel on axial direction</span>
<a name="l00035"></a><a class="code" href="classIsoGaussian.html#b3">00035</a> <span class="keywordtype">void</span> <a class="code" href="classIsoGaussian.html#b3">IsoGaussian::calculateKernelU</a>(Params &amp; params)
00036 {
00037   <span class="keywordtype">float</span> hmax = 1; <span class="comment">//maxum value of kernel</span>
00038   <span class="keywordtype">float</span> hp1 = params.resolutionModel.percentCutoff*hmax; 
00039    <span class="comment">//value at percent cutoff</span>
00040   <span class="keywordtype">float</span> x[Constant::LENGTH_RESFUN]; 
00041      <span class="comment">//coordinate in resolution function space</span>
00042   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iKernel=0; iKernel&lt;   Constant::LENGTH_RESFUN; iKernel++)
00043     x[iKernel] = iKernel- Constant::LENGTH_RESFUN/2.0;
00044   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iResTableU = 0; iResTableU&lt; numResTableU; iResTableU ++)
00045     {
00046       <span class="keywordtype">float</span> rp1 = sqrt(log(hp1)/(-2.772))*fwhmU(iResTableU);
00047                <span class="comment">//percent cutoff coordinates</span>
00048       resFunU[iResTableU].<a class="code" href="structResolutionTable.html#o2">upSpread</a> = 
00049         resFunU[iResTableU].<a class="code" href="structResolutionTable.html#o1">downSpread</a> = rp1;
00050       resFunU[iResTableU].<a class="code" href="structResolutionTable.html#o3">magnification</a> = 
00051         Constant::RESFUNCUTOFF*Constant::LENGTH_RESFUN/(2*rp1);
00052                   <span class="comment">//magnification</span>
00053       resFunU[iResTableU].<a class="code" href="structResolutionTable.html#o0">kCentralIndex</a> = Constant::LENGTH_RESFUN/2; 
00054                 <span class="comment">//central index in the middle</span>
00055       <span class="keywordtype">float</span> dx = params.geometry.dX/resFunU[iResTableU].<a class="code" href="structResolutionTable.html#o3">magnification</a>;
00056                     <span class="comment">//sampling distance</span>
00057       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iKernel=0; iKernel&lt; Constant::LENGTH_RESFUN; iKernel++) 
00058                         <span class="comment">//calculate kernel</span>
00059         {
00060           resFunU[iResTableU].<a class="code" href="structResolutionTable.html#o4">kernel</a>[iKernel] = 
00061             exp(-2.772*POW2((x[iKernel]*dx/fwhmU(iResTableU))));
00062         }
00063     }
00064 }
00065 
00066 <span class="comment">//calculate code index on transaxial direction</span>
<a name="l00067"></a><a class="code" href="classIsoGaussian.html#b0">00067</a> <span class="keywordtype">void</span> <a class="code" href="classIsoGaussian.html#b0">IsoGaussian::calculateCodeIndexR</a>(Params &amp; params,
00068                                       <a class="code" href="classHRRTScannerParams.html">HRRTScannerParams</a> *scanner)
00069 {
00070   <span class="comment">//maping LORs to resolution function index</span>
00071   <span class="keywordtype">float</span> efwhmMax = efwhmR.<a class="code" href="classArray3D.html#a15">max</a>();
00072   <span class="keywordtype">float</span> efwhmMin = efwhmR.<a class="code" href="classArray3D.html#a16">min</a>();
00073 
00074   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; POW2(scanner-&gt;<a class="code" href="classHRRTScannerParams.html#o3">nLayer</a>); i++)
00075     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;scanner-&gt;<a class="code" href="classHRRTScannerParams.html#o10">coincidence</a>; k++)
00076       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;scanner-&gt;<a class="code" href="classHRRTScannerParams.html#o11">nDtct</a>; j++)
00077         {
00078           codeIndexR(i,j,k) = floor((efwhmR(i,j,k)-efwhmMin)
00079                                     /Constant::RES_FUN_SAMPLING);
00080           codeIndexR(i,j+scanner-&gt;<a class="code" href="classHRRTScannerParams.html#o11">nDtct</a>,k) = codeIndexR(i,j,k);
00081         }
00082 }
00083 
00084 <span class="comment">//calculate code index on axial direction</span>
<a name="l00085"></a><a class="code" href="classIsoGaussian.html#b2">00085</a> <span class="keywordtype">void</span> <a class="code" href="classIsoGaussian.html#b2">IsoGaussian::calculateCodeIndexU</a>(Params &amp; params,
00086                                       <a class="code" href="classHRRTScannerParams.html">HRRTScannerParams</a> *scanner)
00087 {
00088   <span class="keywordtype">float</span> efwhmMax = efwhmU.max();
00089   <span class="keywordtype">float</span> efwhmMin = efwhmU.min();
00090 
00091   <span class="comment">//maping LORs to resFunU index</span>
00092   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; POW2(scanner-&gt;<a class="code" href="classHRRTScannerParams.html#o3">nLayer</a>); i++)<span class="comment">//layer</span>
00093     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;scanner-&gt;<a class="code" href="classHRRTScannerParams.html#o12">nRing</a>; j++)<span class="comment">//ring</span>
00094       {
00095         codeIndexU(i,j) = 
00096           floor((efwhmU(i,j)-efwhmMin)/Constant::RES_FUN_SAMPLING);
00097         codeIndexU(i,j+scanner-&gt;<a class="code" href="classHRRTScannerParams.html#o12">nRing</a>) = codeIndexU(i,j);
00098       }
00099 }
00100 
00101 <span class="comment">//constructor</span>
<a name="l00102"></a><a class="code" href="classIsoGaussian.html#a0">00102</a> <a class="code" href="classIsoGaussian.html#a0">IsoGaussian::IsoGaussian</a>(Params &amp; params, <a class="code" href="classHRRTScannerParams.html">HRRTScannerParams</a> *scanner)
00103 {
00104   resFunR = resFunU =0;
00105   <span class="comment">//calculate resolution function on transaxial direction</span>
00106   <a class="code" href="classResolutionFunction.html#a0">calculateFWHMR</a>(params,scanner);
00107   <a class="code" href="classIsoGaussian.html#b0">calculateCodeIndexR</a>(params,scanner);
00108   <a class="code" href="classIsoGaussian.html#b1">calculateKernelR</a>(params); 
00109   <span class="comment">//calculate resolution function on axial direction</span>
00110   <a class="code" href="classResolutionFunction.html#a1">calculateFWHMU</a>(params,scanner);
00111   <a class="code" href="classIsoGaussian.html#b2">calculateCodeIndexU</a>(params, scanner);
00112   <a class="code" href="classIsoGaussian.html#b3">calculateKernelU</a>(params); 
00113 }
00114 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:47 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
