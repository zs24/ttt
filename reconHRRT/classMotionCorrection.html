<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: MotionCorrection class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>MotionCorrection Class Reference</h1><code>#include &lt;<a class="el" href="MotionCorrection_8hpp-source.html">MotionCorrection.hpp</a>&gt;</code>
<p>
<p>Inheritance diagram for MotionCorrection:
<p><center><img src="classMotionCorrection.png" usemap="#MotionCorrection_map" border="0" alt=""></center>
<map name="MotionCorrection_map">
<area href="classPolarisMotionCorrection.html" alt="PolarisMotionCorrection" shape="rect" coords="0,56,149,80">
</map>
<a href="classMotionCorrection-members.html">List of all members.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="classMotionCorrection.html#a0">MotionCorrection</a> (string fileName, Status &amp;status, int scanStartTime, int frameStartTime, int requestedDuration)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="classMotionCorrection.html#a1">~MotionCorrection</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>virtual int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="classMotionCorrection.html#a2">transform</a> (<a class="el" href="classEventPacket.html">EventPacket</a> &amp;event, float &amp;errorEstimate)=0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="classMotionCorrection.html#a3">reset</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="classMotionCorrection.html#a4">getAverageTransformation</a> (float averageXform[])</td></tr>

<tr><td colspan=2><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="p0" doxytag="MotionCorrection::motion" ></a>
<a class="el" href="structMotionCorrection_1_1Motion.html">Motion</a> *&nbsp;</td><td class="memItemRight" valign=bottom><b>motion</b></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="p1" doxytag="MotionCorrection::averageMatrix" ></a>
Array2D&lt; float &gt;&nbsp;</td><td class="memItemRight" valign=bottom><b>averageMatrix</b></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="p2" doxytag="MotionCorrection::index" ></a>
int&nbsp;</td><td class="memItemRight" valign=bottom><b>index</b></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="p3" doxytag="MotionCorrection::numMatrix" ></a>
int&nbsp;</td><td class="memItemRight" valign=bottom><b>numMatrix</b></td></tr>

<tr><td colspan=2><br><h2>Friends</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="anchor" name="n0" doxytag="MotionCorrection::PolarisMotionCorrectionTest" ></a>
class&nbsp;</td><td class="memItemRight" valign=bottom><b>PolarisMotionCorrectionTest</b></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This class is the base class of the motion correction It defines the motion correction method for a frame and provides the transfrom function for the events in the frame 
<p>

<p>
Definition at line <a class="el" href="MotionCorrection_8hpp-source.html#l00014">14</a> of file <a class="el" href="MotionCorrection_8hpp-source.html">MotionCorrection.hpp</a>.<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="MotionCorrection::MotionCorrection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MotionCorrection::MotionCorrection </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">string&nbsp;</td>
          <td class="mdname" nowrap> <em>fileName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>Status &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>status</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>scanStartTime</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>frameStartTime</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>requestedDuration</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The constructor is to read the motion correction data for the full name, generate transform matrices, distrubute those the the various processors <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>fileName</em>&nbsp;</td><td>file name of the motion correction data file, which is provided by the params.frame.motionFilename </td></tr>
    <tr><td valign=top><em>status</em>&nbsp;</td><td>Status object, provides information regarding number of processors and current processors </td></tr>
    <tr><td valign=top><em>scanStartTime</em>&nbsp;</td><td>specifies the start time of the scan in relation to 12:00 AM of the same day, in milliseconds </td></tr>
    <tr><td valign=top><em>framStartTime</em>&nbsp;</td><td>the actual number of milliseconds between the start of the scan and the start of the frame </td></tr>
    <tr><td valign=top><em>requestedDuration</em>&nbsp;</td><td>the requested duration of this frame </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="MotionCorrection_8hpp-source.html#l00050">50</a> of file <a class="el" href="MotionCorrection_8hpp-source.html">MotionCorrection.hpp</a>.
<p>
<div class="fragment"><pre>00052   { 
00053     index =0;
00054     motion = <span class="keyword">new</span> Motion[requestedDuration];
00055   }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="MotionCorrection::~MotionCorrection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MotionCorrection::~<a class="el" href="classMotionCorrection.html">MotionCorrection</a> </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
destructor 
<p>
Definition at line <a class="el" href="MotionCorrection_8hpp-source.html#l00061">61</a> of file <a class="el" href="MotionCorrection_8hpp-source.html">MotionCorrection.hpp</a>.
<p>
<div class="fragment"><pre>00062   {
00063     <span class="keyword">delete</span> []motion;
00064   }
</pre></div>    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a4" doxytag="MotionCorrection::getAverageTransformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int MotionCorrection::getAverageTransformation </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">float&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>averageXform</em>[]          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is used to get the the average transformation matrix <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>averageXform</em>&nbsp;</td><td>the average transformation matrix </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>error code </dd></dl>

<p>
Definition at line <a class="el" href="MotionCorrection_8hpp-source.html#l00106">106</a> of file <a class="el" href="MotionCorrection_8hpp-source.html">MotionCorrection.hpp</a>.
<p>
Referenced by <a class="el" href="FrameInfo_8cpp-source.html#l00117">FrameInfo::init()</a>.
<p>
<div class="fragment"><pre>00107   {
00108     <span class="keywordtype">int</span> matrixSize = averageMatrix.getSize();
00109     memcpy(averageXform, &amp;(averageMatrix(0,0)),matrixSize*<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
00110     <span class="keywordflow">return</span> 1;
00111   }
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="MotionCorrection::reset" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int MotionCorrection::reset </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is used to reset the time counter in the MotionCorrection class. Although the <a class="el" href="classMotionCorrection.html#a2">transform()</a> function is passed an event packet that includes a time stamp, the normal operation is that the <a class="el" href="classMotionCorrection.html#a2">transform()</a> function is called with increasing event.timeStamp values. The MotionCorrection class may rely on this normal operation. The <a class="el" href="classMotionCorrection.html#a3">reset()</a> function is used to indicate to the MotionCorrection class that the timeStamps will be set back to the beginning of the frame. Typically this function is called after a complete construction-traversal of the randomized event list and before constructing the real event list <dl compact><dt><b>Returns:</b></dt><dd>error code </dd></dl>

<p>
Definition at line <a class="el" href="MotionCorrection_8hpp-source.html#l00099">99</a> of file <a class="el" href="MotionCorrection_8hpp-source.html">MotionCorrection.hpp</a>.
<p>
<div class="fragment"><pre>00099 { index =0; <span class="keywordflow">return</span> 1;};
</pre></div>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="MotionCorrection::transform" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> virtual int MotionCorrection::transform </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classEventPacket.html">EventPacket</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>float &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>errorEstimate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [pure virtual]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The transformation is performed on the event's detector coordinates and saved with the event. The second argument is an output argument where, if additional blurring is needed to the event's LOR, it can be specified. The return value is a status code; negtive status codes indicate an error condition; positive status codes can be used to indicate a warning or other message. The <a class="el" href="classMotionCorrection.html#a2">transform()</a> function is called in House::calculateEventParams() just before the call to determineLORCoordinates(). Note that the timing information is stored in event.timeStamp, which is already stored in the event at the time of call to this function. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>event</em>&nbsp;</td><td>a complete event packet </td></tr>
    <tr><td valign=top><em>errorEstimate</em>&nbsp;</td><td>addition blurring inforamtion </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>error code </dd></dl>

<p>
Implemented in <a class="el" href="classPolarisMotionCorrection.html#a1">PolarisMotionCorrection</a>.    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="MotionCorrection_8hpp-source.html">MotionCorrection.hpp</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:50 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
