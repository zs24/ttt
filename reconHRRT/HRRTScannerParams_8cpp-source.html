<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: HRRTScannerParams.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>HRRTScannerParams.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include "HRRTScannerParams.hpp"</span>
00002 <span class="preprocessor">#include "Params.hpp"</span>
00003 <span class="preprocessor">#include "XMLTree.hpp"</span>
00004 <span class="preprocessor">#include "MathMacro.hpp"</span>
00005 <span class="preprocessor">#include "Utilities.hpp"</span>
00006 <span class="preprocessor">#include "Constant.hpp"</span>
00007 <span class="preprocessor">#include "Status.hpp"</span>
00008 
<a name="l00009"></a><a class="code" href="classHRRTScannerParams.html#a0">00009</a> <span class="keywordtype">void</span> <a class="code" href="classHRRTScannerParams.html#a0">HRRTScannerParams::readScannerParams</a>()
00010 {
00011 
00012   <span class="comment">//check if the pointer initialized when use it</span>
00013   Status * status= Status::getStatus();
00014   <span class="keywordflow">if</span>(!checkValid()){
00015     <span class="keywordflow">if</span>(status-&gt;proc==0){
00016       cout&lt;&lt;<span class="stringliteral">"Error in use of HRRTScannerParams"</span>
00017           &lt;&lt;<span class="stringliteral">"Programmer make sure call the getInstance"</span>
00018           &lt;&lt;<span class="stringliteral">"Program aborted"</span>&lt;&lt;endl;
00019       cout.flush();
00020     }
00021     <a class="code" href="classUtilities.html#e8">Utilities::cleanUp</a>(Constant::POINTERERROR);
00022   }
00023   
00024   Params &amp;params = *Params::getInstance();
00025 
00026   string fileName=params.geometry.scannerDefinitionFile;
00027  
00028   XMLTree x(fileName);<span class="comment">//open the XML file</span>
00029 
00030   string subTree = <span class="stringliteral">"scannerParams/panelScannerType/"</span>;
00031   x.getTagValue(subTree, string(<span class="stringliteral">"dtctPerBlock"</span>), this-&gt;dtctPerBlock);
00032   <span class="comment">//detectors per block in x and z directions</span>
00033   x.getTagValue(subTree, <span class="stringliteral">"blockPerBankX"</span>, this-&gt;blockPerBankX);
00034   <span class="comment">//blocks per bank in x direction</span>
00035   x.getTagValue(subTree, <span class="stringliteral">"blockPerBankZ"</span>, this-&gt;blockPerBankZ);
00036   <span class="comment">//blocks per bank in z direction</span>
00037   x.getTagValue(subTree, <span class="stringliteral">"nLayer"</span>, this-&gt;nLayer); <span class="comment">// number of layers</span>
00038   x.getTagValue(subTree, <span class="stringliteral">"nBank"</span>, this-&gt;nBank);   <span class="comment">//number of banks</span>
00039   x.getTagValue(subTree, <span class="stringliteral">"panelSeparation"</span>, this-&gt;panelSeparation); 
00040   <span class="comment">//diameters in mm</span>
00041   x.getTagValue(subTree, <span class="stringliteral">"dtctPitch"</span>, this-&gt;dtctPitch);<span class="comment">//detector pitch in mm</span>
00042   x.getTagValue(subTree, <span class="stringliteral">"dtctDepth1"</span>, this-&gt;dtctDepth1);
00043   <span class="comment">//detector depth in first layer, in mm</span>
00044   x.getTagValue(subTree, <span class="stringliteral">"dtctDepth2"</span>, this-&gt;dtctDepth2);
00045   <span class="comment">//detector depth in second layer, in mm</span>
00046   x.getTagValue(subTree, <span class="stringliteral">"coincidence"</span>, this-&gt;coincidence); 
00047   <span class="comment">//coincidence number</span>
00048   x.getTagValue(subTree, <span class="stringliteral">"livetimeParam0"</span>, this-&gt;liveTimeParam0); 
00049   <span class="comment">//constant term</span>
00050   x.getTagValue(subTree, <span class="stringliteral">"livetimeParam1"</span>, this-&gt;liveTimeParam1); 
00051   <span class="comment">//linear term</span>
00052   x.getTagValue(subTree, <span class="stringliteral">"livetimeParam2"</span>, this-&gt;liveTimeParam2); 
00053 
00054   <span class="comment">//quadratic term</span>
00055   x.getTagValue(subTree, <span class="stringliteral">"dtctType1"</span>, this-&gt;dtctType1);
00056   x.getTagValue(subTree, <span class="stringliteral">"dtctType2"</span>, this-&gt;dtctType2);
00057   x.getTagValue(subTree, <span class="stringliteral">"dtctWidthX"</span>, this-&gt;dtctWidthX);
00058   x.getTagValue(subTree, <span class="stringliteral">"dtctWidthZ"</span>, this-&gt;dtctWidthZ);
00059   x.getTagValue(subTree, <span class="stringliteral">"bankLength"</span>, this-&gt;bankLength);
00060   x.getTagValue(subTree, <span class="stringliteral">"cylinderDiameter"</span>, this-&gt;cylinderDiameter);
00061   x.getTagValue(subTree, <span class="stringliteral">"bankWidth"</span>, this-&gt;bankWidth);
00062   <span class="keywordflow">if</span>(!x.getTagValue(subTree, <span class="stringliteral">"endDtctPitch"</span>, this-&gt;endDtctPitch))
00063     this-&gt;endDtctPitch=2.3 ;
00064   <span class="keywordflow">if</span>(!x.getTagValue(subTree, <span class="stringliteral">"middleDtctPitch"</span>, this-&gt;middleDtctPitch))
00065     this-&gt;middleDtctPitch=2.09 ;
00066   <span class="keywordflow">if</span>(!x.getTagValue(subTree, <span class="stringliteral">"gapWithinBlock"</span>, this-&gt;gapWithinBlock))
00067     this-&gt;gapWithinBlock=0.26 ;
00068   <span class="keywordflow">if</span>(!x.getTagValue(subTree, <span class="stringliteral">"gapBetweenBlock"</span>, this-&gt;gapBetweenBlock))
00069     this-&gt;gapBetweenBlock=0.7 ;
00070 
00071   x.getTagValue(subTree, <span class="stringliteral">"timeStampsPerSecond"</span>, 
00072                 this-&gt;timeStampsPerSecond);
00073  <span class="comment">//quadratic term</span>
00074   this-&gt;nDtct = this-&gt;blockPerBankX*this-&gt;dtctPerBlock;
00075   <span class="comment">//detector number in x directions</span>
00076   this-&gt;nRing = this-&gt;blockPerBankZ*this-&gt;dtctPerBlock; 
00077   <span class="comment">//detector number in z direction</span>
00078   this-&gt;numLOR = POW2(<span class="keywordtype">float</span>(this-&gt;nDtct*this-&gt;nRing*this-&gt;nLayer))
00079     *float(this-&gt;nBank*this-&gt;coincidence)/2.; <span class="comment">//total possible LORs</span>
00080   this-&gt;nBlock = this-&gt;blockPerBankX*this-&gt;blockPerBankZ*
00081     this-&gt;nBank;
00082 
00083   <span class="comment">//calculate masked scanner</span>
00084   string value, attributes[50];
00085   x.multipleTags = <span class="keyword">true</span>;
00086   x.tagCount = 1;
00087   <span class="keywordflow">while</span>(x.getTagValue(subTree, <span class="stringliteral">"mask"</span>, value,
00088                       attributes[x.tagCount-1])){
00089     <span class="comment">//    cout &lt;&lt;"Value:"&lt;&lt;value[x.tagCount-1]&lt;&lt;" attributes:"</span>
00090     <span class="comment">//          &lt;&lt;attributes[x.tagCount-1]&lt;&lt;endl;</span>
00091     x.tagCount++;
00092   }
00093   nMask = x.tagCount - 1;
00094 
00095 
00096   <span class="comment">// Allocate an array of strings of appropriate size and fill with</span>
00097   <span class="comment">// the mask attributes that we have received from the file.</span>
00098   <span class="keywordflow">if</span>(nMask &gt; 0){
00099     cout&lt;&lt;<span class="stringliteral">"Detected "</span>&lt;&lt;nMask&lt;&lt;<span class="stringliteral">" masks:"</span>&lt;&lt;endl;
00100     maskAttributes = <span class="keyword">new</span> string[nMask];
00101     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iMask=0;iMask&lt;nMask;iMask++){
00102       maskAttributes[iMask] = attributes[iMask];
00103       cout&lt;&lt;<span class="stringliteral">"mask:"</span>&lt;&lt;attributes[iMask]&lt;&lt;endl;
00104     }
00105   }
00106   <span class="comment">//  if(nMask&gt;0) {</span>
00107   <span class="comment">// mask=new Mask[nMask];</span>
00108   <span class="comment">// processMask(attributes);</span>
00109   <span class="comment">//}</span>
00110   x.multipleTags=<span class="keyword">false</span>;
00111   x.tagCount=0;
00112 
00113   <span class="comment">// Now indicate that filled is true, to show that the scanner</span>
00114   <span class="comment">// parameters have been read in </span>
00115 
00116   filled = <span class="keyword">true</span>;
00117 }
00118 
<a name="l00119"></a><a class="code" href="classHRRTScannerParams.html#a1">00119</a> <span class="keywordtype">void</span> <a class="code" href="classHRRTScannerParams.html#a1">HRRTScannerParams::bcastMaskAttributes</a>() {
00120 
00121   <span class="keywordflow">if</span>(nMask &gt; 0 &amp;&amp; filled) {
00122       Status *status = Status::getStatus();
00123       <span class="keywordtype">char</span> attrib[nMask][MASK_ATTRIBUTES_MAXSIZE];
00124       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt;nMask ; i++) {
00125         <span class="keywordflow">if</span>(status-&gt;proc == 0) {
00126            strcpy(attrib[i], maskAttributes[i].c_str());
00127         }
00128       }
00129       <span class="keywordflow">if</span>(status-&gt;proc != 0) 
00130         this-&gt;maskAttributes = <span class="keyword">new</span> string[nMask];
00131  
00132       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iMask=0;iMask&lt;nMask;iMask++){
00133         <a class="code" href="classUtilities.html#e2">Utilities::mpiBcast</a>(0, attrib[iMask], MASK_ATTRIBUTES_MAXSIZE);
00134       
00135         <span class="keywordflow">if</span>(status-&gt;proc != 0) {
00136            this-&gt;maskAttributes[iMask] = string(attrib[iMask]);
00137            cout&lt;&lt;<span class="stringliteral">"maskAttributes["</span>&lt;&lt;iMask&lt;&lt;<span class="stringliteral">"] : "</span>&lt;&lt;this-&gt;maskAttributes[iMask]&lt;&lt;<span class="stringliteral">" at proc: "</span>&lt;&lt;status-&gt;proc&lt;&lt;endl;
00138         }
00139       }
00140    }
00141 }
<a name="l00146"></a><a class="code" href="classHRRTScannerParams.html#a2">00146</a> <span class="keywordtype">void</span> <a class="code" href="classHRRTScannerParams.html#a2">HRRTScannerParams::write</a>(ostream &amp; os)
00147 {
00148   
00149   os&lt;&lt;<span class="stringliteral">"scanner-&gt;dtctPerBlock is: "</span>&lt;&lt;this-&gt;dtctPerBlock;
00150   os&lt;&lt;<span class="stringliteral">", scanner-&gt;blockPerBankX is: "</span>&lt;&lt;this-&gt;blockPerBankX&lt;&lt;endl;
00151   os&lt;&lt;<span class="stringliteral">"scanner-&gt;blockPerBankZ is: "</span>&lt;&lt;this-&gt;blockPerBankZ;
00152   os&lt;&lt; <span class="stringliteral">", scanner-&gt;nLayer is: "</span>&lt;&lt; this-&gt;nLayer&lt;&lt;endl;
00153   os&lt;&lt; <span class="stringliteral">"scanner-&gt;nBank is: "</span>&lt;&lt;this-&gt;nBank;
00154   os&lt;&lt;<span class="stringliteral">", scanner-&gt;panelSeparation is: "</span>&lt;&lt;this-&gt;panelSeparation&lt;&lt;endl;
00155   os&lt;&lt; <span class="stringliteral">"scanner-&gt;dtctPitch is: "</span>&lt;&lt;this-&gt;dtctPitch;
00156   os&lt;&lt;<span class="stringliteral">", scanner-&gt;dtctDepth1 is: "</span>&lt;&lt;this-&gt;dtctDepth1&lt;&lt;endl;
00157   os&lt;&lt;<span class="stringliteral">"scanner-&gt;dtctDepth2 is: "</span>&lt;&lt;this-&gt;dtctDepth2;
00158   os&lt;&lt;<span class="stringliteral">", scanner-&gt;coincidence is: "</span>&lt;&lt; this-&gt;coincidence&lt;&lt;endl;
00159   os&lt;&lt;<span class="stringliteral">"scanner-&gt;nDtct is: "</span>&lt;&lt; this-&gt;nDtct;
00160   os&lt;&lt;<span class="stringliteral">", scanner-&gt;nRing is: "</span>&lt;&lt;this-&gt;nRing&lt;&lt;endl;
00161   os&lt;&lt;<span class="stringliteral">"scanner-&gt;numLOR is: "</span>&lt;&lt; this-&gt;numLOR&lt;&lt;endl;
00162   os&lt;&lt;<span class="stringliteral">"endDtctPitch is: "</span>&lt;&lt;this-&gt;endDtctPitch&lt;&lt;endl;
00163   os&lt;&lt;<span class="stringliteral">"middleDtctPitch is : "</span>&lt;&lt;this-&gt;middleDtctPitch&lt;&lt;endl;
00164   os&lt;&lt;<span class="stringliteral">"gapWithinBlock is: "</span>&lt;&lt;this-&gt;gapWithinBlock&lt;&lt;endl;
00165   os&lt;&lt;<span class="stringliteral">"gapBetweenBlock is: "</span>&lt;&lt;this-&gt;gapBetweenBlock&lt;&lt;endl;
00166 }
00167 
00168   
00169 
00170 
00171 
00172         
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:47 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
