<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: HRRTHouse.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>HRRTHouse.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00002 <span class="preprocessor">#include &lt;string.h&gt;</span>
00003 <span class="preprocessor">#include &lt;sstream&gt;</span>
00004 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00005 <span class="preprocessor">#include "HRRTHouse.hpp"</span>
00006 <span class="preprocessor">#include "Status.hpp"</span>
00007 <span class="preprocessor">#include "ResolutionFunction.hpp"</span>
00008 <span class="preprocessor">#include "IsoGaussian.hpp"</span>
00009 <span class="preprocessor">#include "Utilities.hpp"</span>
00010 <span class="preprocessor">#include "Constant.hpp"</span>
00011 <span class="preprocessor">#include "TOC.hpp"</span>
00012 
00013 
00014 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00015 <span class="comment">/*</span>
00016 <span class="comment">2004-07-23 rc fixed livetime calculation</span>
00017 <span class="comment"></span>
00018 <span class="comment"> 2004-07-21 rc fixed typo in the randoms corrections</span>
00019 <span class="comment">  multiply randoms.singlesScaleFactor - not divide</span>
00020 <span class="comment">  added more randoms verbosity output</span>
00021 <span class="comment">  fixed numLOR calculation to be floating point</span>
00022 <span class="comment">  prevented crash if params-&gt;frame.verbosity is 0</span>
00023 <span class="comment"> */</span>
00024 
<a name="l00030"></a><a class="code" href="classHRRTHouse.html#a1">00030</a> <span class="keywordtype">void</span> <a class="code" href="classHRRTHouse.html#a1">HRRTHouse::init</a>()
00031 {
00032  
00033   checkSum = <span class="keyword">sizeof</span>(<a class="code" href="classHRRTHouse.html">HRRTHouse</a>);
00034  <span class="comment">//init params pointer by obtaining a singleton</span>
00035   params = Params::getInstance();
00036   <span class="comment">//init scanner pointer by obtaining a singleton</span>
00037   scanner= <a class="code" href="classHRRTScannerParams.html#e0">HRRTScannerParams::getInstance</a>();
00038   <span class="comment">//init scanner instance</span>
00039   Status *status = Status::getStatus();
00040 
00041   <span class="comment">//proc 0 reads the scanner params file and broadcasts it to others</span>
00042   <span class="keywordflow">if</span>(status-&gt;proc == 0) 
00043       scanner-&gt;<a class="code" href="classHRRTScannerParams.html#a0">readScannerParams</a>();
00044   <a class="code" href="classUtilities.html#e2">Utilities::mpiBcast</a>(0, scanner, <span class="keyword">sizeof</span>(<a class="code" href="classHRRTScannerParams.html">HRRTScannerParams</a>));
00045   <span class="keywordflow">if</span>(scanner-&gt;<a class="code" href="classHRRTScannerParams.html#o30">nMask</a> &gt; 0) {
00046      scanner-&gt;<a class="code" href="classHRRTScannerParams.html#a1">bcastMaskAttributes</a>();
00047   }
00048   
00049   <span class="comment">//for debug purpose</span>
00050   <span class="comment">//if(params-&gt;frame.verbosity&gt;=4)</span>
00051    <span class="comment">// scanner-&gt;write(cout);</span>
00052 
00053   <span class="comment">// Obtain a pointer to HRRTHouseMask singleton and then initialize it</span>
00054   houseMask = HRRTHouseMask::getInstance();
00055   houseMask-&gt;init();
00056   <span class="keywordflow">if</span>(params-&gt;frame.verbosity&gt;=3)
00057    cout&lt;&lt;<span class="stringliteral">"Processor "</span>&lt;&lt;status-&gt;proc&lt;&lt;<span class="stringliteral">" houseMask init complete"</span>&lt;&lt;endl;
00058 
00059   <span class="comment">//set scanner parameters from  the xml file</span>
00060   <span class="keywordflow">if</span>(params-&gt;frame.verbosity&gt;=4)
00061     scanner-&gt;<a class="code" href="classHRRTScannerParams.html#a2">write</a>(cout);
00062   
00063     
00064 
00065   <span class="comment">//calculate and store resolution tables</span>
00066   houseResolution = HRRTHouseResolution::getInstance();
00067   houseResolution-&gt;createResolutionTable(); 
00068   <span class="comment">//calculate detector normalization sensitivity factors</span>
00069   houseNorm = HRRTHouseNorm::getInstance();
00070    <span class="comment">//calculate and store detector coordinates</span>
00071   houseNorm-&gt;setHrrtDtct();
00072   houseNorm-&gt;calculateDtctSensitivity();
00073   <span class="comment">//calculate detector normalization geometry factors</span>
00074   houseNorm-&gt;calculateAxGeoFctr();
00075   <span class="comment">//calculate detector normalization geometry factors</span>
00076   houseNorm-&gt;calculateTxGeoFctr(); 
00077   <span class="comment">//reading the alpha factors to adjust efficiency with count rate</span>
00078   houseNorm-&gt;read_countrate_factor();
00079   houseSingles = HRRTHouseSingles::getInstance();
00080   houseSingles-&gt;<a class="code" href="classHRRTHouseSingles.html#d4">computeBlockEff</a>();
00081 
00082   houseList = HRRTHouseList::getInstance();
00083   <span class="comment">//open log file</span>
00084   <span class="comment">/*fLog.open("logFile",ios::app);</span>
00085 <span class="comment">    if(!fLog)</span>
00086 <span class="comment">    {</span>
00087 <span class="comment">    cout&lt;&lt;"Error openning logFile "&lt;&lt;endl;</span>
00088 <span class="comment">    MPI::COMM_WORLD.Abort(-1);</span>
00089 <span class="comment">    }*/</span>
00090   houseEvent = HRRTHouseEvent::getInstance();
00091   <span class="keywordflow">if</span>(params-&gt;frame.verbosity&gt;=4)
00092     cout&lt;&lt;<span class="stringliteral">"Processor "</span>&lt;&lt;status-&gt;proc&lt;&lt;<span class="stringliteral">" HRRTHouse init complete"</span>&lt;&lt;endl;
00093   
00094  }
00095 
<a name="l00099"></a><a class="code" href="classHRRTHouse.html#a14">00099</a> <a class="code" href="classHRRTHouse.html#a14">HRRTHouse::~HRRTHouse</a>()
00100 {
00101   <span class="comment">//fclose(lun);</span>
00102   <span class="keywordflow">if</span>(params-&gt;frame.verbosity&gt;=5)
00103     cout&lt;&lt;<span class="stringliteral">"deleting house ..."</span>&lt;&lt;endl;
00104 
00105   <span class="keywordflow">if</span>(houseResolution-&gt;resFunR) <span class="keyword">delete</span> [] houseResolution-&gt;resFunR;
00106   <span class="keywordflow">if</span>(houseResolution-&gt;resFunU) <span class="keyword">delete</span> [] houseResolution-&gt;resFunU;
00107   <span class="comment">//delete the motion correction class</span>
00108   <span class="keywordflow">if</span>(params-&gt;frame.verbosity&gt;=5) {
00109     cout&lt;&lt;<span class="stringliteral">"house deleted ..."</span>&lt;&lt;endl;
00110   }
00111 }
00112 
00113 
00114 <span class="comment">//---------------------------------------------------------------------</span>
00115 <span class="comment">//write to log file</span>
00116 <span class="comment">//---------------------------------------------------------------------</span>
00117 <span class="keywordtype">void</span> HRRTHouse::writeToLog(<span class="keyword">const</span> <a class="code" href="classEventPacket.html">EventPacket</a> &amp; event)
00118 {
00119   fLog&lt;&lt;<span class="stringliteral">" An event does not have two intersactions with FOV "</span>&lt;&lt;endl;
00120   fLog&lt;&lt;<span class="stringliteral">"  event.x1 = "</span>&lt;&lt;event.<a class="code" href="classEventPacket.html#o12">x1</a>&lt;&lt;<span class="stringliteral">", event.y1 = "</span>&lt;&lt;event.<a class="code" href="classEventPacket.html#o13">y1</a>&lt;&lt;<span class="stringliteral">", event.z1 = "</span> &lt;&lt; event.<a class="code" href="classEventPacket.html#o14">z1</a>&lt;&lt;endl;
00121   fLog&lt;&lt;<span class="stringliteral">"  event.x2 = "</span>&lt;&lt;event.<a class="code" href="classEventPacket.html#o15">x2</a>&lt;&lt;<span class="stringliteral">", event.y2 = "</span>&lt;&lt;event.<a class="code" href="classEventPacket.html#o16">y2</a>&lt;&lt;<span class="stringliteral">", event.z2 = "</span> &lt;&lt; event.<a class="code" href="classEventPacket.html#o17">z2</a>&lt;&lt;endl;
00122 }
00123 
00124 
00125 
00126 <span class="comment">//return scanner params struct</span>
<a name="l00127"></a><a class="code" href="classHRRTHouse.html#a16">00127</a> <a class="code" href="classHRRTScannerParams.html">HRRTScannerParams</a> *<a class="code" href="classHRRTHouse.html#a16">HRRTHouse::getScannerParams</a>()
00128 {
00129   <span class="comment">//check if the pointer initialized when use it</span>
00130   <span class="keywordflow">if</span>(!checkValid()){
00131     cout&lt;&lt;<span class="stringliteral">"Error in use of HRRTHouse"</span>
00132         &lt;&lt;<span class="stringliteral">"Programmer make sure call the getInstance"</span>
00133         &lt;&lt;<span class="stringliteral">"Program aborted"</span>&lt;&lt;endl;
00134     cout.flush();
00135     <a class="code" href="classUtilities.html#e8">Utilities::cleanUp</a>(Constant::POINTERERROR);
00136   }
00137 
00138   <span class="keywordflow">return</span> scanner;
00139 }
00140 
00141 
00142 
00143 <span class="comment">//---------------------------------------------------------------------</span>
00144 <span class="comment">//NAME:</span>
00145 <span class="comment">//  getFrameInfo()</span>
00146 <span class="comment">//SYNOPSIS</span>
00147 <span class="comment">//  returns the summary frame information from the current </span>
00148 <span class="comment">// frame acquisition</span>
00149 <span class="comment">//OUTPUT</span>
00150 <span class="comment">//              FrameInfo struct</span>
00151 <span class="comment">//---------------------------------------------------------------------</span>
<a name="l00152"></a><a class="code" href="classHRRTHouse.html#a15">00152</a> <a class="code" href="classFrameInfo.html">FrameInfo</a> &amp;<a class="code" href="classHRRTHouse.html#a15">HRRTHouse::getFrameInfo</a>()
00153 {
00154   <a class="code" href="classFrameInfo.html">FrameInfo</a> &amp; frameInfo =* FrameInfo::getInstance();
00155   <span class="comment">//frameInfo.init();</span>
00156   <span class="keywordflow">return</span> frameInfo;
00157 }
00158         
00159 <span class="comment">/*;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
00160 <span class="comment">  ;+</span>
00161 <span class="comment">  ;       NAME</span>
00162 <span class="comment">  ;               getResFunR</span>
00163 <span class="comment">  ;</span>
00164 <span class="comment">  ;       SYNOPSIS</span>
00165 <span class="comment">  ;               resfun = getResFunR(const short &amp; index)</span>
00166 <span class="comment">  ;</span>
00167 <span class="comment">  ;       INPUT</span>
00168 <span class="comment">  ;                             index - index of r resolution function</span>
00169 <span class="comment">  ;             OUTPUT</span>
00170 <span class="comment">  ;          resFunR[index] - Resolution function in radial direction </span>
00171 <span class="comment">  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;*/</span>
00172 
<a name="l00173"></a><a class="code" href="classHRRTHouse.html#a2">00173</a> <a class="code" href="structResolutionTable.html">ResolutionTable</a> <a class="code" href="classHRRTHouse.html#a2">HRRTHouse::getResFunR</a>(<span class="keyword">const</span> <span class="keywordtype">short</span> &amp;index)
00174 {
00175   <span class="keywordflow">return</span> houseResolution-&gt;getResFunR(index);
00176 }
00177         
00178 <span class="comment">/*;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
00179 <span class="comment">  ;+</span>
00180 <span class="comment">  ;       NAME</span>
00181 <span class="comment">  ;               getResFunZ</span>
00182 <span class="comment">  ;</span>
00183 <span class="comment">  ;       SYNOPSIS</span>
00184 <span class="comment">  ;               resfun = getResFunZ(const short &amp; index)</span>
00185 <span class="comment">  ;</span>
00186 <span class="comment">  ;       PARAMETERS</span>
00187 <span class="comment">  ;               resFunU - Resolution function in axial direction </span>
00188 <span class="comment">  ;               index - index into U resolution function</span>
00189 <span class="comment">  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;*/</span>
<a name="l00190"></a><a class="code" href="classHRRTHouse.html#a3">00190</a> <a class="code" href="structResolutionTable.html">ResolutionTable</a> <a class="code" href="classHRRTHouse.html#a3">HRRTHouse::getResFunZ</a>(<span class="keyword">const</span> <span class="keywordtype">short</span> &amp;index)
00191 {
00192   <span class="keywordflow">return</span> houseResolution-&gt;getResFunZ(index);
00193 }
00194 
00195 
00196 <span class="comment">//---------------------------------------------------------------------</span>
00197 <span class="comment">//return singles</span>
00198 <span class="comment">//---------------------------------------------------------------------</span>
<a name="l00199"></a><a class="code" href="classHRRTHouse.html#a4">00199</a> <a class="code" href="classArray1D.html">Array1D&lt;int&gt;</a> &amp;<a class="code" href="classHRRTHouse.html#a4">HRRTHouse::getSingles</a>()
00200 {
00201   <span class="keywordflow">return</span> houseSingles-&gt;<a class="code" href="classHRRTHouseSingles.html#d5">getSingles</a>();
00202 }
00203 
00204 <span class="comment">//-----------------------------------------------------------------</span>
00205 <span class="comment">//Compute the random coincidence rate for a pair of detectors</span>
00206 <span class="comment">//---------------------------------------------------------------------</span>
<a name="l00207"></a><a class="code" href="classHRRTHouse.html#a5">00207</a> <span class="keywordtype">float</span> <a class="code" href="classHRRTHouse.html#a5">HRRTHouse::getRandoms</a>(<span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e1, 
00208                             <span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e2)
00209 {
00210   <span class="keywordflow">return</span> houseSingles-&gt;<a class="code" href="classHRRTHouseSingles.html#d7">getRandoms</a>(e1,e2);
00211 }
00212 
<a name="l00222"></a><a class="code" href="classHRRTHouse.html#a6">00222</a> <span class="keywordtype">bool</span> <a class="code" href="classHRRTHouse.html#a6">HRRTHouse:: prepareListData</a>(){
00223   <span class="keywordflow">return</span> houseList-&gt;<a class="code" href="classHRRTHouseList.html#d19">prepareListData</a>();
00224 }
00225   
00226 
<a name="l00236"></a><a class="code" href="classHRRTHouse.html#a7">00236</a> <span class="keywordtype">bool</span> <a class="code" href="classHRRTHouse.html#a7">HRRTHouse::prepareRandomizedListData</a>(){
00237   <span class="keywordflow">return</span> houseList-&gt;<a class="code" href="classHRRTHouseList.html#d20">prepareRandomizedListData</a>();
00238 }
00239 
00240 <span class="comment">//-----------------------------------------------------------------------------</span>
00241 <span class="comment">/* - Returns the next event (which could be of real list-mode data or</span>
00242 <span class="comment">   randomized data depending on initialization).  This method is called</span>
00243 <span class="comment">   repeatedly and the events are returned in the same order that they</span>
00244 <span class="comment">   appear in the list file.  Returns null when the end of the list has</span>
00245 <span class="comment">   been reached, i.e., when the end of the list mode file is reached or</span>
00246 <span class="comment">   when the end time of this frame is reached.  The House reads the</span>
00247 <span class="comment">   list-mode file while getNextEvent() calls are made.  It uses an</span>
00248 <span class="comment">   internal buffering system.* * It fills in values for most of the</span>
00249 <span class="comment">   EventPacket. Depending on the parameter set, it calculates the</span>
00250 <span class="comment">   coordinates of the detector pair, applies motion correction,</span>
00251 <span class="comment">   converts to image corrdinates, finds the intersection of this LOR</span>
00252 <span class="comment">   with the FOV and defines sinphi, cosphi, costheta, jstart,jstop,</span>
00253 <span class="comment">   secondaryStart, zStart, secondaryStep, zStep,. It calculates the</span>
00254 <span class="comment">   randoms estimate, rand, the normalization estimate norm, and defines</span>
00255 <span class="comment">   the resolution model codes resModelCodeR and resModelCodeU. It also</span>
00256 <span class="comment">   fills in the LOR information for the scatter correction</span>
00257 <span class="comment">   psi1,psi2,zeta1,zeta. **</span>
00258 <span class="comment">*/</span>
00259 <span class="comment">//--------------------------------------------------------------------------</span>
<a name="l00260"></a><a class="code" href="classHRRTHouse.html#a8">00260</a> <a class="code" href="classEventPacket.html">EventPacket</a> <a class="code" href="classHRRTHouse.html#a8">HRRTHouse::getNextEvent</a>(){
00261   <span class="keywordflow">return</span> houseEvent-&gt;<a class="code" href="classHRRTHouseEvent.html#d5">getNextEvent</a>();
00262 }
00263 
00264 
00265 <span class="comment">//---------------------------------------------------------------------</span>
00266 <span class="comment">//return detector number from:</span>
00267 <span class="comment">// dtct: detector number in transaxle direction in a bank, 0: 72</span>
00268 <span class="comment">// layer: layer number, 0:1</span>
00269 <span class="comment">// bank: bank number, 0:7</span>
00270 <span class="comment">// ring: detector number in axle direction in a bank, 0:103</span>
00271 <span class="comment">//---------------------------------------------------------------------</span>
<a name="l00272"></a><a class="code" href="classHRRTHouse.html#a9">00272</a> <span class="keywordtype">int</span> <a class="code" href="classHRRTHouse.html#a9">HRRTHouse::getCrystalNumber</a>(<span class="keywordtype">int</span> dtct, <span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> bank, <span class="keywordtype">int</span> ring)
00273 { 
00274   <span class="keywordflow">return</span> houseEvent-&gt;<a class="code" href="classHRRTHouseEvent.html#d6">getCrystalNumber</a>(dtct, layer, bank, ring);
00275 }
00276 
00277 <span class="comment">//---------------------------------------------------------------------</span>
00278 <span class="comment">//get detector parameters from detector number</span>
00279 <span class="comment">//      dtct: detector number in transaxle direction in a bank, 0: 72</span>
00280 <span class="comment">//      layer: layer number, 0:1</span>
00281 <span class="comment">//      bank: bank number, 0:7</span>
00282 <span class="comment">//      ring: detector number in axle direction in a bank, 0:103</span>
00283 <span class="comment">//---------------------------------------------------------------------</span>
<a name="l00284"></a><a class="code" href="classHRRTHouse.html#a10">00284</a> <a class="code" href="structCrystalID.html">CrystalID</a> <a class="code" href="classHRRTHouse.html#a10">HRRTHouse::getHrrtId</a>(<span class="keywordtype">int</span> n){
00285   <span class="keywordflow">return</span> houseEvent-&gt;<a class="code" href="classHRRTHouseEvent.html#d7">getHrrtId</a>(n);
00286 }
00287 
<a name="l00292"></a><a class="code" href="classHRRTHouse.html#a11">00292</a> <span class="keywordtype">float</span> <a class="code" href="classHRRTHouse.html#a11">HRRTHouse::getTotalPossibleEvents</a>()
00293 {
00294   <span class="keywordflow">return</span> houseEvent-&gt;<a class="code" href="classHRRTHouseEvent.html#d8">getTotalPossibleEvents</a>();
00295 }
<a name="l00301"></a><a class="code" href="classHRRTHouse.html#a17">00301</a> <span class="keywordtype">bool</span> <a class="code" href="classHRRTHouse.html#a17">HRRTHouse::isTimeTag</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *b)
00302 {
00303   <span class="keywordflow">return</span> houseList-&gt;<a class="code" href="classHRRTHouseList.html#d6">isTimeTag</a>(b);
00304 }
<a name="l00309"></a><a class="code" href="classHRRTHouse.html#a18">00309</a> <span class="keywordtype">bool</span> <a class="code" href="classHRRTHouse.html#a18">HRRTHouse::isSinglesTag</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *b)
00310 {
00311   <span class="keywordflow">return</span> houseList-&gt;<a class="code" href="classHRRTHouseList.html#d7">isSinglesTag</a>(b);
00312 }
00313 
<a name="l00318"></a><a class="code" href="classHRRTHouse.html#a19">00318</a> <span class="keywordtype">bool</span> <a class="code" href="classHRRTHouse.html#a19">HRRTHouse::isEvent</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *b)
00319 {
00320   <span class="keywordflow">return</span> houseList-&gt;<a class="code" href="classHRRTHouseList.html#d8">isEvent</a>(b);
00321 }
<a name="l00328"></a><a class="code" href="classHRRTHouse.html#a20">00328</a> <span class="keywordtype">bool</span> <a class="code" href="classHRRTHouse.html#a20">HRRTHouse::processEvent</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *b, 
00329                              <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e1, 
00330                              <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e2)
00331 {
00332   <span class="keywordflow">return</span> houseList-&gt;<a class="code" href="classHRRTHouseList.html#d12">processEvent</a>(b,e1,e2);
00333 }
<a name="l00339"></a><a class="code" href="classHRRTHouse.html#a21">00339</a> <span class="keywordtype">bool</span> <a class="code" href="classHRRTHouse.html#a21">HRRTHouse::calculateEventParams</a>(<span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e1, 
00340                          <span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e2,
00341                          <a class="code" href="classEventPacket.html">EventPacket</a> &amp;event, <span class="keywordtype">int</span> t)
00342 {
00343   <span class="keywordflow">return</span> houseEvent-&gt;<a class="code" href="classHRRTHouseEvent.html#d4">calculateEventParams</a>(e1, e2, event, t);
00344 }
<a name="l00347"></a><a class="code" href="classHRRTHouse.html#a22">00347</a> <span class="keywordtype">float</span> <a class="code" href="classHRRTHouse.html#a22">HRRTHouse::getSen</a>(<span class="keywordtype">int</span> dtct, <span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> bank, <span class="keywordtype">int</span> ring, <span class="keywordtype">int</span> singles){
00348   <span class="keywordflow">return</span> houseNorm-&gt;getSen(dtct,layer,bank,ring,singles);
00349 }
00350 
00351 <span class="comment">/******************************************************</span>
00352 <span class="comment"> * putNextEvent() - Called from</span>
00353 <span class="comment"> * AlgorithmSimulation::collectDistribute()</span>
00354 <span class="comment"> * This function takes a fully-formed event packet, extracts the</span>
00355 <span class="comment"> * fundamental identifying variables, and decodes them into a</span>
00356 <span class="comment"> * raw-event (a 64-bit word) for output to a list-mode file</span>
00357 <span class="comment"> * representing a simulation  realization.  It keeps track of the</span>
00358 <span class="comment"> * current (or, actually "previous") time tag for a particular</span>
00359 <span class="comment"> * realization.  When the time tag changes, this function also writes</span>
00360 <span class="comment"> * out a time stamp event and a block singles event.</span>
00361 <span class="comment"> *@param event the event to be written</span>
00362 <span class="comment"> *@param irealiz - The realization number which identifies the file to</span>
00363 <span class="comment"> *be written .  </span>
00364 <span class="comment"> *@return true if everything OK, false if errors in I/O or unProcessEvent</span>
00365 <span class="comment"> */</span>
<a name="l00366"></a><a class="code" href="classHRRTHouse.html#a23">00366</a> <span class="keywordtype">bool</span> <a class="code" href="classHRRTHouse.html#a23">HRRTHouse::putNextEvent</a>(<a class="code" href="classEventPacket.html">EventPacket</a> &amp; event, <span class="keywordtype">int</span> irealiz)
00367 {
00368   <span class="keywordflow">return</span> houseList-&gt;<a class="code" href="classHRRTHouseList.html#d24">putNextEvent</a>(event, irealiz);
00369 }
00370 
00371 <span class="comment">/**************************************************</span>
00372 <span class="comment"> * prepareOutput</span>
00373 <span class="comment"> * This is a public function (to the parent) that needs to be called from</span>
00374 <span class="comment"> * AlgorithmSimulation::collectDistribute() prior to the actual</span>
00375 <span class="comment"> * redistribution of events.  It opens the output file corresponding</span>
00376 <span class="comment"> * to realization irealiz.  The filename is formed from the listmode</span>
00377 <span class="comment"> * filename in params.frame.listmodeFilename, with a substring</span>
00378 <span class="comment"> * inserted identifying the realization in front of the last "."</span>
00379 <span class="comment"> * In the event of an error condition, Utilities::cleanup() is called.</span>
00380 <span class="comment"> *@param irealiz - Identifies the realization number</span>
00381 <span class="comment"> ***************************/</span>
00382 
00383 <span class="keywordtype">void</span> HRRTHouse::prepareOutput(<span class="keywordtype">int</span> irealiz)
00384 {
00385   houseList-&gt;<a class="code" href="classHRRTHouseList.html#d25">prepareOutput</a>(irealiz);
00386 }
00387 
00388 
00389 
00390 <span class="comment">/*************************************************************************</span>
00391 <span class="comment"> * finalizeOutput</span>
00392 <span class="comment"> * Called toward the end of AlgorithmSimulation::collectDistribute,</span>
00393 <span class="comment"> * this function closes the output list-mode realization files</span>
00394 <span class="comment"> * assigned to the processor.</span>
00395 <span class="comment"> * If the realization number is not assigned to the current processor,</span>
00396 <span class="comment"> * this function will generate an error condition and call </span>
00397 <span class="comment"> * Utilities::cleanup()</span>
00398 <span class="comment"> ********************************************/</span>
00399 
00400 <span class="keywordtype">void</span> HRRTHouse::finalizeOutput(<span class="keywordtype">int</span> irealiz)
00401 {
00402   houseList-&gt;<a class="code" href="classHRRTHouseList.html#d26">finalizeOutput</a>(irealiz);
00403 }
00404 
00405 
00406 
<a name="l00414"></a><a class="code" href="classHRRTHouse.html#a24">00414</a> <span class="keywordtype">void</span> <a class="code" href="classHRRTHouse.html#a24">HRRTHouse::bcastSinglesPackets</a>()
00415 {
00416   houseSingles-&gt;<a class="code" href="classHRRTHouseSingles.html#d9">bcastSinglesPackets</a>();
00417 }
00418 
00419 <span class="comment">//determine if the detectors of the event are masked out</span>
00420 <span class="comment">//returns true if yes, otherwise returns false</span>
00421 <span class="keywordtype">bool</span> HRRTHouse::maskOut(<span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e1, <span class="keyword">const</span> <a class="code" href="structCrystalID.html">CrystalID</a> &amp; e2) {
00422   <span class="keywordflow">return</span> houseMask-&gt;maskOut(e1, e2);
00423 }
00424   
00425 
00426 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:47 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
