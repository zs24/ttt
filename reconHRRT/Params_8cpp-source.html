<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>reconHRRT: Params.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>Params.cpp</h1><div class="fragment"><pre>00001 
00007 <span class="preprocessor">#include &lt;string&gt;</span>
00008 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00009 <span class="preprocessor">#include &lt;fstream&gt;</span>
00010 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00011 
00012 <span class="preprocessor">#include "Params.hpp"</span>
00013 <span class="preprocessor">#include "Status.hpp"</span>
00014 <span class="preprocessor">#include "Utilities.hpp"</span>
00015 <span class="preprocessor">#include "Constant.hpp"</span>
00016 
00017 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00018 
00019 <span class="comment">// --------------------------------------------------------------------</span>
00020 <span class="comment">//   parse</span>
00021 <span class="comment">// --------------------------------------------------------------------</span>
00022 <span class="keywordtype">void</span> Params::parse(string xmlFile)
00023 {
00024   <span class="comment">//check if the pointer initialized when use it</span>
00025   Status * status= Status::getStatus();
00026   <span class="keywordflow">if</span>(!checkValid()){
00027     <span class="comment">// **** I do not  think that Status has been initialized yet!!!</span>
00028     <span class="comment">//if(status-&gt;proc==0){</span>
00029       cout&lt;&lt;<span class="stringliteral">"Error in use of Params class"</span>
00030           &lt;&lt;<span class="stringliteral">"Programmer make sure call the getInstance"</span>
00031           &lt;&lt;<span class="stringliteral">"Program aborted"</span>&lt;&lt;endl;
00032       cout.flush();
00033     <span class="comment">//}</span>
00034     <a class="code" href="classUtilities.html#e8">Utilities::cleanUp</a>(Constant::POINTERERROR);
00035   }
00036 <span class="keywordflow">if</span>(strcmp(xmlFile.c_str(), <span class="stringliteral">""</span>) == 0) {
00037     cerr &lt;&lt; <span class="stringliteral">"XML File Name is empty\n"</span>;
00038     <span class="keywordflow">return</span>;
00039   }     
00040   ifstream fs(xmlFile.c_str());
00041   <span class="keywordflow">if</span>(fs.fail()) 
00042     { 
00043       cerr &lt;&lt; (<span class="stringliteral">"Error opening Params XML File:"</span>+xmlFile+<span class="stringliteral">"\n"</span>);
00044       fs.close();
00045       <span class="keywordflow">return</span>;
00046     }
00047   fs.close();
00048         
00049   xml.parseFile(xmlFile);
00050   string rootNode = <span class="stringliteral">"hrrt_params/"</span>;
00051   string curSubTree;
00052   <span class="comment">// Algorithm Structure</span>
00053 
00054   curSubTree = rootNode+string(<span class="stringliteral">"Algorithm/"</span>);
00055   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AlgorithmName"</span>), 
00056                       algorithm.name)) 
00057     algorithm.name = <span class="stringliteral">""</span>;
00058   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Subsets"</span>), 
00059                       algorithm.numSets)) 
00060     algorithm.numSets = 0;
00061   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Iterations"</span>), 
00062                       algorithm.numIterations)) 
00063     algorithm.numIterations = 0;
00064   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"NumRealizations"</span>), 
00065                       algorithm.numRealizations)) 
00066     algorithm.numRealizations = 0;
00067   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"PriorStrength"</span>), 
00068                       algorithm.priorStrength)) 
00069     algorithm.priorStrength = 0;
00070   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"RelaxParam"</span>), 
00071                       algorithm.relaxParam)) 
00072     algorithm.relaxParam = 0;
00073   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"PriorName"</span>), 
00074                       algorithm.priorName)) 
00075     algorithm.priorName = <span class="stringliteral">""</span>;
00076   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"NeighborhoodX"</span>), 
00077                       algorithm.neighborhoodX)) 
00078     algorithm.neighborhoodX = 0;
00079   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"NeighborhoodY"</span>), 
00080                       algorithm.neighborhoodY)) 
00081     algorithm.neighborhoodY = 0;
00082   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"NeighborhoodZ"</span>), 
00083                       algorithm.neighborhoodZ)) 
00084     algorithm.neighborhoodZ = 0;
00085   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"n_Q"</span>), algorithm.n_Q)) 
00086     algorithm.n_Q = 0;
00087   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Q_fwhmx"</span>), algorithm.Q_fwhmx)) 
00088     algorithm.Q_fwhmx = 5; <span class="comment">//default smoothing in number of pixels</span>
00089   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Q_fwhmy"</span>), algorithm.Q_fwhmy)) 
00090     algorithm.Q_fwhmy = 5; <span class="comment">//default smoothing in number of pixels</span>
00091   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Q_fwhmz"</span>), algorithm.Q_fwhmz)) 
00092     algorithm.Q_fwhmz = 5; <span class="comment">//default smoothing in number of pixels       </span>
00093   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"nSimEvents"</span>), 
00094                       algorithm.nSimEvents)) 
00095     algorithm.nSimEvents = 0;
00096   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AlgorithmKeys"</span>), 
00097                       algorithm.algorithmKeys)) 
00098     algorithm.algorithmKeys = <span class="stringliteral">""</span>;
00099   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AlgorithmValues"</span>), 
00100                       algorithm.algorithmValues)) 
00101     algorithm.algorithmValues = <span class="stringliteral">""</span>;
00102   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"OutputIterationIncrement"</span>), 
00103                       algorithm.outputIterationIncrement)) 
00104     algorithm.outputIterationIncrement = 0;
00105   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"QThreshold"</span>),  
00106                       algorithm.Qthreshold)) 
00107     algorithm.Qthreshold = 0;
00108   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"EnableOutputMasking"</span>),  
00109                       algorithm.enableOutputMasking)) 
00110     algorithm.enableOutputMasking = 5;
00111   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"EnableInitLambdaMasking"</span>),  
00112                       algorithm.enableInitLambdaMasking)) 
00113     algorithm.enableInitLambdaMasking = 1;
00114   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"InitialValue"</span>), 
00115                       algorithm.initialValue)) 
00116     algorithm.initialValue = 0;
00117   <span class="comment">// boundary backoff c an now be an array of 2 : image and LOR control</span>
00118   <span class="comment">// if only onve value defined, use for image, and set LOR to 2 less</span>
00119   string tagVal = <span class="stringliteral">""</span>;
00120   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"BoundaryBackOff"</span>), tagVal)) { 
00121         algorithm.boundaryBackOff[0]=5;
00122         algorithm.boundaryBackOff[1]=3;
00123    } <span class="keywordflow">else</span> {
00124     <span class="keywordtype">int</span> upIt;
00125     <span class="keywordtype">int</span> i =0 ;
00126     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j =0 ; j &lt; 2 ; j++) 
00127       algorithm.boundaryBackOff[j] = -1;
00128     <span class="keywordflow">while</span> ((upIt = tagVal.find_first_of(<span class="stringliteral">","</span>)) 
00129            != string::npos) {   
00130       algorithm.boundaryBackOff[i] = 
00131         atoi(tagVal.substr(0, upIt).c_str());
00132       tagVal = tagVal.substr(upIt+1);
00133       i++;
00134     }
00135     algorithm.boundaryBackOff[i] = 
00136       atoi(tagVal.substr(upIt+1).c_str());
00137     <span class="keywordflow">if</span> (i == 0) algorithm.boundaryBackOff[1] = algorithm.boundaryBackOff[0]-2 ;
00138   }
00139   <span class="comment">// ensure that there are no negatives</span>
00140   <span class="keywordflow">if</span> (algorithm.boundaryBackOff[0] &lt; 0) 
00141    algorithm.boundaryBackOff[0] = 0;
00142   <span class="keywordflow">if</span> (algorithm.boundaryBackOff[1] &lt; 0) 
00143    algorithm.boundaryBackOff[1] = 0;
00144   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>), 
00145                       algorithm.verbosity)) 
00146     algorithm.verbosity = 0;
00147   <span class="keywordflow">if</span> (algorithm.verbosity &gt;= 3) {
00148      cout&lt;&lt;<span class="stringliteral">"boundary backoff "</span>&lt;&lt;        algorithm.boundaryBackOff[0] &lt;&lt;<span class="stringliteral">" "</span>
00149       &lt;&lt; algorithm.boundaryBackOff[1]&lt;&lt;endl;
00150   }
00151   <span class="comment">/* Attenuation Structure */</span>
00152   curSubTree = rootNode+string(<span class="stringliteral">"Attenuation/"</span>);
00153   tagVal = <span class="stringliteral">""</span>;
00154   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"enable"</span>), tagVal)) 
00155     tagVal = <span class="stringliteral">""</span>;
00156   attenuation.enable = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00157   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ThresholdValue"</span>), 
00158                       attenuation.threshold)) 
00159     attenuation.threshold=0.0;
00160   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AttenuationFileName"</span>), 
00161                       attenuation.muImageFilename)) 
00162     attenuation.muImageFilename=<span class="stringliteral">""</span>;
00163   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"mu_FWHM"</span>), 
00164                       attenuation.mu_FWHM)) 
00165     attenuation.mu_FWHM=0.0;
00166   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"MuScale"</span>), 
00167                       attenuation.muScale)) 
00168     attenuation.muScale=0.1;
00169   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>), 
00170                       attenuation.verbosity)) 
00171     attenuation.verbosity=0;
00172         
00173   <span class="comment">// Randoms Structure</span>
00174   curSubTree = rootNode+string(<span class="stringliteral">"Randoms/"</span>);
00175   tagVal = <span class="stringliteral">""</span>;
00176   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"enable"</span>), tagVal)) 
00177     tagVal = <span class="stringliteral">""</span>;
00178   randoms.enable = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00179   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Tau"</span>), randoms.tau)) 
00180     randoms.tau = 0.0;
00181   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"RandomsType"</span>), 
00182                       randoms.randomsType)) 
00183     randoms.randomsType = 0;
00184   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AveragingInterval"</span>), 
00185                       randoms.averagingInterval)) 
00186     randoms.averagingInterval = 0;
00187   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"DeadTimeCorrection"</span>),
00188                       randoms.deadTimeCorrection)) 
00189     randoms.deadTimeCorrection = 0;
00190   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>), 
00191                       randoms.verbosity)) 
00192     randoms.verbosity=0;
00193   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"SinglesScaleFactor"</span>),
00194                       randoms.singlesScaleFactor)) 
00195     randoms.singlesScaleFactor = 0.0;
00196         
00197   <span class="comment">// Normalization Structure</span>
00198   curSubTree = rootNode+<span class="stringliteral">"Normalization/"</span>;
00199   tagVal = <span class="stringliteral">""</span>;
00200   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"enable"</span>), tagVal)) 
00201     tagVal = <span class="stringliteral">""</span>;
00202   normalization.enable = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00203   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"NormalizationType"</span>), 
00204                       normalization.normalizationType)) 
00205     normalization.normalizationType = <span class="stringliteral">""</span>;
00206   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"NormalizationFileName"</span>), 
00207                       normalization.filePath)) 
00208     normalization.filePath = <span class="stringliteral">""</span>;
00209   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"GlobalSens"</span>), 
00210                       normalization.globalsens)) 
00211     normalization.globalsens = 0.0;
00212   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"NormSinglesRate"</span>), 
00213                       normalization.normSinglesRate)) 
00214     normalization.normSinglesRate = 0;
00215   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"EffOffset"</span>), 
00216                       normalization.effOffset)) 
00217     normalization.effOffset = 3.69e-06;
00218   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>), 
00219                       normalization.verbosity)) 
00220     normalization.verbosity = 0;
00221 
00222   <span class="comment">// MotionCorrection Structure</span>
00223   curSubTree = rootNode+<span class="stringliteral">"MotionCorrection/"</span>;
00224   tagVal = <span class="stringliteral">""</span>;
00225   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"enable"</span>), tagVal)) 
00226     tagVal = <span class="stringliteral">""</span>;
00227   motionCorrection.enable = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00228   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"MCType"</span>), 
00229                       motionCorrection.motionCorrectionType)) 
00230     motionCorrection.motionCorrectionType = 0;
00231   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AveragingInterval"</span>), 
00232  motionCorrection.averagingInterval)) 
00233     motionCorrection.averagingInterval = 0;
00234   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"MotionCorrectionFile"</span>), 
00235                       motionCorrection.motionCorrectionFile)) 
00236     motionCorrection.motionCorrectionFile = <span class="stringliteral">""</span>;
00237   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>), 
00238                       motionCorrection.verbosity)) 
00239     motionCorrection.verbosity = 0;
00240         
00241   <span class="comment">// ResolutionModel Structure</span>
00242   curSubTree = rootNode+<span class="stringliteral">"ResolutionModel/"</span>;
00243   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ModelType"</span>), 
00244                       resolutionModel.modelType)) 
00245     resolutionModel.modelType = <span class="stringliteral">""</span>;
00246   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Asymmetry"</span>), 
00247                       resolutionModel.asymmetry)) 
00248     resolutionModel.asymmetry = <span class="stringliteral">""</span>;
00249   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"DetectorObliqueness"</span>), 
00250                       resolutionModel.detectorObliqueness)) 
00251     resolutionModel.detectorObliqueness = 0;
00252   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"CrystalPosition"</span>), 
00253                       resolutionModel.crystalPosition)) 
00254     resolutionModel.crystalPosition = 0;
00255   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"BlockPosition"</span>), 
00256                       resolutionModel.blockPosition)) 
00257     resolutionModel.blockPosition = 0;
00258   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"FWHM"</span>), 
00259                       resolutionModel.FWHM)) 
00260     resolutionModel.FWHM = 0;
00261   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"PercentCutOff"</span>), 
00262                       resolutionModel.percentCutoff)) 
00263     resolutionModel.percentCutoff = 0;
00264   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"MotionCorrectionUncertainty"</span>),
00265                       resolutionModel.motionCorrectionUncertainty)) 
00266     resolutionModel.motionCorrectionUncertainty = 0;
00267   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ExternalTabFileName"</span>), 
00268                       resolutionModel.xtab_file)) 
00269     resolutionModel.xtab_file = <span class="stringliteral">""</span>;
00270   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Layer"</span>), 
00271                       resolutionModel.layer)) 
00272     resolutionModel.layer = 0;
00273   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>), 
00274                       resolutionModel.verbosity)) 
00275     resolutionModel.verbosity = 0;
00276         
00277   <span class="comment">// ModelBasedScatter Structure</span>
00278   curSubTree = rootNode+<span class="stringliteral">"ModelBasedScatter/"</span>;
00279   tagVal = <span class="stringliteral">""</span>;
00280   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"enable"</span>), tagVal)) 
00281     tagVal = <span class="stringliteral">""</span>;
00282   modelBasedScatter.enable = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00283   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ModelType"</span>),  
00284                       modelBasedScatter.modelType )) 
00285     modelBasedScatter.modelType = <span class="stringliteral">""</span>;
00286   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ScatterPointSeparation"</span>), 
00287                       modelBasedScatter.pointSeparation )) 
00288     modelBasedScatter.pointSeparation = 0;
00289   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ScatterPointOffset"</span>), 
00290                       modelBasedScatter.pointOffset )) 
00291     modelBasedScatter.pointOffset = 0;
00292   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"SpaceRadius"</span>),  
00293                       modelBasedScatter.spaceRadius )) 
00294     modelBasedScatter.spaceRadius = 0;
00295   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"EndPointAxialStep"</span>), 
00296                       modelBasedScatter.endPointAxialStep )) 
00297     modelBasedScatter.endPointAxialStep = 0;
00298   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"EndPointAzimuthalStep"</span>),  
00299                       modelBasedScatter.endPointAzimuthalStep )) 
00300     modelBasedScatter.endPointAzimuthalStep = 0;
00301   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ReconLLD"</span>), 
00302                       modelBasedScatter.reconLLD)) 
00303     modelBasedScatter.reconLLD = 0.0;
00304   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"GlobalScaleFactor"</span>), 
00305                       modelBasedScatter.globalScaleFactor)) 
00306     modelBasedScatter.globalScaleFactor = 0.0;
00307   tagVal = <span class="stringliteral">""</span>;
00308   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ComputeIncidenceAngles"</span>), tagVal)) 
00309     tagVal = <span class="stringliteral">""</span>;
00310    modelBasedScatter.computeIncidenceAngles = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00311   tagVal = <span class="stringliteral">""</span>;
00312   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"UpdateIteration"</span>),  tagVal)) 
00313     tagVal = <span class="stringliteral">""</span>;
00314   {
00315     <span class="keywordtype">int</span> upIt;
00316     <span class="keywordtype">int</span> i =0 ;
00317     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j =0 ; j &lt; SCATTER_UPDATE_ARR_LEN ; j++) 
00318       modelBasedScatter.updateIteration[j] = <span class="stringliteral">"-1"</span>;
00319     <span class="keywordflow">while</span> ((upIt = tagVal.find_first_of(<span class="stringliteral">","</span>)) != string::npos) {        
00320       modelBasedScatter.updateIteration[i] = 
00321         <a class="code" href="classUtilities.html#e10">Utilities::trim</a>(tagVal.substr(0, upIt).c_str());
00322       tagVal = tagVal.substr(upIt+1);
00323       i++;
00324     }
00325     modelBasedScatter.updateIteration[i] = <a class="code" href="classUtilities.html#e10">Utilities::trim</a>(tagVal);
00326   }
00327   tagVal = <span class="stringliteral">""</span>;
00328   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"UpdateSamplingFactor"</span>), 
00329                       tagVal)) 
00330     tagVal = <span class="stringliteral">""</span>;
00331   {
00332     <span class="keywordtype">int</span> upIt;
00333     <span class="keywordtype">int</span> i =0 ;
00334     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j =0 ; j &lt; SCATTER_UPDATE_ARR_LEN ; j++) 
00335       modelBasedScatter.updateSamplingFactor[j] = -1.0;
00336     <span class="keywordflow">while</span> ((upIt = tagVal.find_first_of(<span class="stringliteral">","</span>)) != string::npos) {
00337       modelBasedScatter.updateSamplingFactor[i] = 
00338         atof(tagVal.substr(0, upIt).c_str());
00339       tagVal = tagVal.substr(upIt+1);
00340       i++;
00341     }
00342     modelBasedScatter.updateSamplingFactor[i] = atof(tagVal.c_str());
00343   }
00344   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AutoScaling"</span>),  
00345                       modelBasedScatter.autoScaling)) 
00346     modelBasedScatter.autoScaling = 1;
00347   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"RaySumStepSize"</span>),  
00348                       modelBasedScatter.raySumStepSize)) 
00349     modelBasedScatter.raySumStepSize = 0.0;
00350   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AttenThreshold"</span>),  
00351                       modelBasedScatter.attenThreshold)) 
00352     modelBasedScatter.attenThreshold = 0.0;
00353   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AttenScaleParam0"</span>),  
00354                       modelBasedScatter.attenScaleParam0)) 
00355     modelBasedScatter.attenScaleParam0 = 0.0;
00356   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AttenScaleParam1"</span>),  
00357                       modelBasedScatter.attenScaleParam1)) 
00358     modelBasedScatter.attenScaleParam1 = 0.0;
00359   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AttenScaleParam2"</span>),  
00360                       modelBasedScatter.attenScaleParam2)) 
00361     modelBasedScatter.attenScaleParam2 = 0.0;
00362   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"DetectionEffParam0"</span>),  
00363                       modelBasedScatter.detectionEffParam0)) 
00364     modelBasedScatter.detectionEffParam0 = 0.0;
00365   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"DetectionEffParam1"</span>),  
00366                       modelBasedScatter.detectionEffParam1)) 
00367     modelBasedScatter.detectionEffParam1 = 0.0;
00368   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"DetectionEffParam2"</span>),  
00369                       modelBasedScatter.detectionEffParam2)) 
00370     modelBasedScatter.detectionEffParam2 = 0.0;
00371   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"DetectionThreshold"</span>),  
00372                       modelBasedScatter.detectionThreshold)) 
00373     modelBasedScatter.detectionThreshold = 0.0;
00374   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"EnergyResolution"</span>),  
00375                       modelBasedScatter.energyResolution)) 
00376     modelBasedScatter.energyResolution = 1.0;
00377   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"EnergyBackground"</span>),  
00378                       modelBasedScatter.energyBackground)) 
00379     modelBasedScatter.energyBackground = 0.25;
00380   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>),  
00381                       modelBasedScatter.verbosity)) 
00382     modelBasedScatter.verbosity = 0;
00383         
00384   <span class="comment">// Geomtry Structure</span>
00385   curSubTree = rootNode+<span class="stringliteral">"Geometry/"</span>;
00386   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"n_x"</span>),  geometry.nX)) 
00387     geometry.nX = 0;
00388   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"n_y"</span>),  geometry.nY)) 
00389     geometry.nY = 0;
00390   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"n_z"</span>),  geometry.nZ)) 
00391     geometry.nZ = 0;
00392   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"FOV_r"</span>),  geometry.FOV_r)) 
00393     geometry.FOV_r = 0;
00394   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"FOV_z"</span>),  geometry.FOV_z)) 
00395     geometry.FOV_z = 0;
00396   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"d_x"</span>),  geometry.dX)) 
00397     geometry.dX = 0;
00398   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"d_y"</span>),  geometry.dY)) 
00399     geometry.dY = 0;
00400   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"d_z"</span>),  geometry.dZ)) 
00401     geometry.dZ = 0;
00402   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Offset_x"</span>),  geometry.offsetX)) 
00403     geometry.offsetX = 0;
00404   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Offset_y"</span>),  geometry.offsetY)) 
00405     geometry.offsetY = 0;
00406   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Offset_z"</span>),  geometry.offsetZ)) 
00407     geometry.offsetZ = 0;
00408   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ScannerDefinitionFile"</span>),  
00409                       geometry.scannerDefinitionFile)) 
00410     geometry.scannerDefinitionFile = <span class="stringliteral">""</span>;
00411 
00412   <span class="comment">//Sinogram Structure</span>
00413   curSubTree = rootNode+<span class="stringliteral">"SinogramGeometry/"</span>;
00414   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Type"</span>),  sinogram.type)) 
00415     sinogram.type = <span class="stringliteral">""</span>;
00416   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Nr"</span>),  sinogram.nr)) 
00417     sinogram.nr = 0;
00418   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Nphi"</span>),  sinogram.nphi)) 
00419     sinogram.nphi = 0;
00420   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"min_Zmid"</span>),  
00421                       sinogram.min_zmid)) 
00422     sinogram.min_zmid = 0;
00423   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"max_Zmid"</span>),  
00424                       sinogram.max_zmid)) 
00425     sinogram.max_zmid = 0;
00426   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"numSinos"</span>),  
00427                       sinogram.numSinos)) 
00428     sinogram.numSinos = 0;
00429   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"minTheta"</span>),  
00430                       sinogram.minTheta)) 
00431     sinogram.minTheta = 0;
00432   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"maxTheta"</span>),  
00433                       sinogram.maxTheta)) 
00434     sinogram.maxTheta = 0;
00435   tagVal = <span class="stringliteral">""</span>;
00436   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"enable"</span>), tagVal)) 
00437     tagVal = <span class="stringliteral">""</span>;
00438   sinogram.enable = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00439   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>),  
00440                       sinogram.verbosity)) 
00441     sinogram.verbosity = 0;
00442   tagVal = <span class="stringliteral">""</span>;
00443   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"UpdateIteration"</span>),  tagVal)) 
00444     tagVal = <span class="stringliteral">""</span>;
00445   {
00446     <span class="keywordtype">int</span> upIt;
00447     <span class="keywordtype">int</span> i =0 ;
00448     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j =0 ; j &lt; SCATTER_UPDATE_ARR_LEN ; j++) 
00449       sinogram.updateIteration[j] = -1;
00450     <span class="keywordflow">while</span> ((upIt = tagVal.find_first_of(<span class="stringliteral">","</span>)) != string::npos) {
00451       sinogram.updateIteration[i] = 
00452         atoi(tagVal.substr(0, upIt).c_str());
00453       tagVal = tagVal.substr(upIt+1);
00454       i++;
00455     }
00456     sinogram.updateIteration[i] = atoi(tagVal.substr(upIt+1).c_str());
00457   }
00458         
00459   <span class="comment">// Frame Structure</span>
00460   curSubTree = rootNode+<span class="stringliteral">"Frame/"</span>;
00461   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"FrameStartTime"</span>),  
00462                       frame.frameStartTime)) 
00463     frame.frameStartTime=<span class="stringliteral">""</span>;
00464   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ScanStartTime"</span>),  
00465                       frame.scanStartTime)) 
00466     frame.scanStartTime=<span class="stringliteral">""</span>;
00467   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Duration"</span>),  
00468                       frame.duration)) 
00469     frame.duration=<span class="stringliteral">""</span>;
00470   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Isotope"</span>),  frame.isotope)) 
00471     frame.isotope=<span class="stringliteral">""</span>;
00472   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Halflife"</span>),  frame.halflife)) 
00473     frame.halflife=0.0;
00474   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"PositronFraction"</span>),  
00475                       frame.positronFraction)) 
00476     frame.positronFraction=0.0;
00477   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"DecayCorrectionTime"</span>), 
00478                       frame.decayCorrectionTime)) 
00479     frame.decayCorrectionTime=<span class="stringliteral">""</span>;
00480   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"StudyDir"</span>),  
00481                       frame.studyDirectory)) 
00482     frame.studyDirectory=<span class="stringliteral">""</span>;
00483   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"FrameDir"</span>),  
00484                       frame.frameDirectory)) 
00485     frame.frameDirectory=<span class="stringliteral">""</span>;
00486   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"InputFileName"</span>), 
00487                       frame.listmodeFilename)) 
00488     frame.listmodeFilename=<span class="stringliteral">""</span>;
00489   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"XMLFileName"</span>),  
00490                       frame.xmlFilename)) 
00491     frame.xmlFilename=<span class="stringliteral">""</span>;
00492   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"StudyDesc"</span>),  
00493                       frame.studyDescription)) 
00494     frame.studyDescription=<span class="stringliteral">""</span>;
00495   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"OutputFileNameBase"</span>),  
00496                       frame.outputFileNameBase)) 
00497     frame.studyDescription=<span class="stringliteral">""</span>;
00498   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"OutputFileType"</span>),  
00499                       frame.outputFileType)) 
00500     frame.outputFileType=<span class="stringliteral">""</span>;
00501   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"FramesId"</span>),  
00502                       frame.frameNumber)) 
00503     frame.frameNumber = 0;
00504   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"StartingIteration"</span>),  
00505                       frame.startingIteration)) 
00506     frame.startingIteration = 0;
00507   tagVal = <span class="stringliteral">""</span>;
00508   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"UsePreviousResult"</span>),  
00509                       tagVal)) 
00510     tagVal = <span class="stringliteral">""</span>;
00511   frame.usePreviousResult = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00512   <span class="comment">// no longer look for UseStartingImage (gives error)</span>
00513   <span class="comment">//tagVal = "";</span>
00514   <span class="comment">//if(!xml.getTagValue(curSubTree, string("UseStartingImage"),  </span>
00515   <span class="comment">//                  tagVal)) </span>
00516   <span class="comment">//  tagVal = "";</span>
00517   <span class="comment">//frame.useStartingImage = (tagVal == "yes")?true:false;</span>
00518   tagVal = <span class="stringliteral">""</span>;
00519   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"StartingImage"</span>),  frame.startingImage))
00520     frame.startingImage = <span class="stringliteral">""</span>;
00521   <span class="keywordflow">if</span>(frame.startingImage == <span class="stringliteral">"0"</span> || frame.startingImage == <span class="stringliteral">"1"</span>) 
00522      frame.startingImage = <span class="stringliteral">""</span>;
00523   <span class="comment">// 2006-02-20 set useStartingImage based on presence of startingImage</span>
00524   frame.useStartingImage = (frame.startingImage != <span class="stringliteral">""</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00525   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ScaleStartingImage"</span>),  tagVal)) 
00526     tagVal = <span class="stringliteral">""</span>;
00527   frame.scaleStartingImage = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00528   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"OutputDataType"</span>),  
00529                       frame.outputDataType)) 
00530     frame.outputDataType = <span class="stringliteral">""</span>;
00531   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"InputLLD"</span>),  frame.inputLLD)) 
00532     frame.inputLLD = 0.0;
00533   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"LookForZero"</span>),  tagVal)) 
00534     tagVal = <span class="stringliteral">""</span>;
00535   frame.lookForZero = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00536   tagVal = <span class="stringliteral">""</span>;
00537   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"EnableBoundsCheck"</span>),  tagVal)) 
00538     tagVal = <span class="stringliteral">""</span>;
00539   frame.enableBoundsCheck = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00540   tagVal = <span class="stringliteral">""</span>;
00541   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ScratchPath"</span>),  frame.scratchPath)) 
00542     frame.scratchPath = <span class="stringliteral">""</span>;
00543     <span class="comment">// (whjl)</span>
00544   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"SimulationImageFile"</span>),  frame.simulationImageFile)) 
00545     frame.simulationImageFile = <span class="stringliteral">""</span>;
00546   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"SimulationTimeFile"</span>), 
00547     frame.simulationTimeFile)) 
00548     frame.simulationTimeFile = <span class="stringliteral">""</span>;
00549   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"ProcessWholeFile"</span>),  tagVal)) 
00550     tagVal = <span class="stringliteral">""</span>;
00551     frame.processWholeFile = (tagVal == <span class="stringliteral">"yes"</span>)?<span class="keyword">true</span>:<span class="keyword">false</span>;
00552   tagVal = <span class="stringliteral">""</span>;
00553   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"Verbosity"</span>),  frame.verbosity)) 
00554     frame.verbosity = 0;
00555 
00556   <span class="comment">// Extensions Structure</span>
00557   curSubTree = rootNode+<span class="stringliteral">"Extensions/"</span>;
00558   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"XMLExt"</span>),  extensions.xml)) 
00559     extensions.xml = <span class="stringliteral">""</span>;
00560   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"StatusExt"</span>),  
00561                       extensions.status)) 
00562     extensions.status = <span class="stringliteral">""</span>;
00563   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"RawExt"</span>),  extensions.raw)) 
00564     extensions.raw = <span class="stringliteral">""</span>;
00565   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"DicomExt"</span>),  extensions.dicom)) 
00566     extensions.dicom = <span class="stringliteral">""</span>;
00567   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"AnalyzeExt"</span>),  
00568                       extensions.analyze)) 
00569     extensions.analyze = <span class="stringliteral">""</span>;
00570   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"InterfileExt"</span>),  
00571                       extensions.interfile)) 
00572     extensions.interfile = <span class="stringliteral">""</span>;
00573   <span class="keywordflow">if</span>(!xml.getTagValue(curSubTree, string(<span class="stringliteral">"FrameInfoExt"</span>),  
00574                       extensions.frameInfo)) 
00575     extensions.frameInfo = <span class="stringliteral">""</span>;
00576  
00577   <span class="comment">//convert the params.algorithm.name to lower case</span>
00578   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;algorithm.name.length(); i++){
00579     algorithm.name.replace(i,1,1,tolower(algorithm.name.c_str()[i]));
00580   }
00581   <span class="comment">//force the subset to 1 for simulation</span>
00582   <span class="keywordflow">if</span>(algorithm.name == <span class="stringliteral">"simulation"</span>)
00583     algorithm.numSets = 1;
00584 }       
00585 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Dec 13 14:13:48 2007 for reconHRRT by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
